(function(n,t){typeof module=="object"&&typeof module.exports=="object"?module.exports=n.document?t(n,!0):function(n){if(!n.document)throw new Error("Avalon requires a window with a document");return t(n)}:t(n)})(typeof window!="undefined"?window:this,function(n,t){function u(){n.console&&avalon.config.debug&&Function.apply.call(console.log,console,arguments)}function l(){}function ut(n,t){var r,u,i,f;for(typeof n=="string"&&(n=n.match(e)||[]),r={},u=t!==void 0?t:1,i=0,f=n.length;i<f;i++)r[n[i]]=u;return r}function ho(){if(n.VBArray){var t=document.documentMode;return t?t:n.XMLHttpRequest?7:6}return NaN}function ou(n){return so.test(ht.call(n))}function cu(n,t){return n=Math.floor(n)||0,n<0?Math.max(t+n,0):Math.min(n,t)}function co(n){var t,i;if(!n)return!1;if(t=n.length,t===t>>>0){if(i=ht.call(n).slice(8,-1),/(?:regexp|string|function|window|global)$/i.test(i))return!1;if(i==="Array")return!0;try{return{}.propertyIsEnumerable.call(n,"length")===!1?/^\s?function/.test(n.item||n.callee):!0}catch(r){return!n.window}}return!1}function kt(n,t,i){var r="for(var "+n+"i=0,n = this.length; i < n; i++){"+t.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+i;return Function("fn,scope",r)}function vu(n,t){try{while(t=t.parentNode)if(t===n)return!0;return!1}catch(i){return!1}}function yu(){return(new XMLSerializer).serializeToString(this)}function yo(n){var t={},f,e,u,r;for(f in n)t[f]=n[f];return e=t.target=n.srcElement,n.type.indexOf("key")===0?t.which=n.charCode!=null?n.charCode:n.keyCode:pu.test(n.type)&&(u=e.ownerDocument||i,r=u.compatMode==="BackCompat"?u.body:u.documentElement,t.pageX=n.clientX+(r.scrollLeft>>0)-(r.clientLeft>>0),t.pageY=n.clientY+(r.scrollTop>>0)-(r.clientTop>>0),t.wheelDeltaY=t.wheelDelta,t.wheelDeltaX=0),t.timeStamp=new Date-0,t.originalEvent=n,t.preventDefault=function(){n.returnValue=!1},t.stopPropagation=function(){n.cancelBubble=!0},t}function s(n){var t,i;for(t in n)g.call(n,t)&&(i=n[t],typeof s.plugins[t]=="function"?s.plugins[t](i):typeof s[t]=="object"?avalon.mix(s[t],i):s[t]=i);return this}function gu(n){return(n+"").replace(du,"\\$&")}function it(n,t,i){var l,o,s,r,f,u,e;if(Array.isArray(n))return l=n.concat(),n.length=0,o=rs(n),o.pushArray(l),o;if(!n||n.$id&&n.$events||n.nodeType>0&&n.nodeName)return n;s=Array.isArray(n.$skipArray)?n.$skipArray:[];s.$special=t||{};r={};i=i||{};var h={},c={},a=[];for(ei.forEach(function(t){delete n[t]}),f=Object.keys(n),f.forEach(function(t,r){var u=n[t],f;i[t]=u;ts(t,u,s)&&(h[t]=[],f=avalon.type(u),f==="object"&&ft(u.get)&&Object.keys(u).length<=2?(r=bo(t,u),a.push(r)):r=fu.test(f)?ko(t,u,f,h[t],i):wo(t,u),c[t]=r)}),r=si(r,ff(c),n),u=0;u<f.length;u++)e=f[u],c[e]||(r[e]=n[e]);gt(r,"$id",w());gt(r,"$model",i);gt(r,"$events",h);oi?gt(r,"hasOwnProperty",function(n){return n in r.$model}):r.hasOwnProperty=function(n){return n in r.$model&&n!=="hasOwnProperty"};for(u in dt)gt(r,u,dt[u].bind(r));return r.$reinitialize=function(){a.forEach(function(n){delete n._value;delete n.oldArgs;n.digest=function(){n.call(r)};et.begin({callback:function(t,i){var u=i._name,r;i!==n&&(r=t.$events[u],ci(r,n.digest))}});try{n.get.call(r)}finally{et.end()}})},r.$reinitialize(),r}function gt(n,t,i){oi?Object.defineProperty(n,t,{value:i,writable:!0,enumerable:!1,configurable:!0}):n[t]=i}function wo(n,t){function i(n){var t=i._value;return arguments.length>0?(wt||fr(n,t)||(i.updateValue(this,n),i.notify(this,n,t)),this):(et.collectDependency(this,i),t)}return ur(i,n),i._value=t,i}function bo(n,t){function i(t){var r=i._value,e="_value"in i,u,f;return arguments.length>0?wt?this:(typeof i.set=="function"&&i.oldArgs!==t&&(i.oldArgs=t,u=this.$events,f=u[n],u[n]=[],i.set.call(this,t),u[n]=f,t=i.get.call(this),t!==r&&(i.updateValue(this,t),i.notify(this,t,r))),this):(t=i.get.call(this),i.updateValue(this,t),e&&r!==t&&i.notify(this,t,r),t)}return i.set=t.set,i.get=t.get,ur(i,n),i}function ko(n,t,i,u,f){function e(t){var y=e._value,f=e._vmodel,v,u,c,a;if(arguments.length>0){if(wt)return this;if(i==="array"){var o=f,l=t,s=o.length,h=l.length;for(o.$lock=!0,s>h?o.splice(h,s-h):h>s&&o.push.apply(o,l.slice(s)),v=Math.min(s,h),u=0;u<v;u++)o.set(u,l[u]);delete o.$lock;o._fire("set")}else if(i==="object"){t=t.$model?t.$model:t;c=this.$events[n]||[];a=avalon.mix(!0,{},t);for(u in f)f.hasOwnProperty(u)&&g.call(a,u)&&(f[u]=a[u]);f=e._vmodel=it(t);f.$events[p]=c;c.length&&c.forEach(function(n){n.type&&(n.rollback&&n.rollback(),r[n.type](n,n.vmodels))})}return e.updateValue(this,f.$model),e.notify(this,this._value,y),this}return et.collectDependency(this,e),f}ur(e,n);f[n]=Array.isArray(t)?t:f[n]||{};var o=e._vmodel=it(t,0,f[n]);return o.$events[p]=u,e}function go(n,t){n.$model[this._name]=this._value=t}function ns(n,t,i){var r=this._name,u=n.$events[r];u&&(hr(u),dt.$fire.call(n,r,t,i))}function ur(n,t){n._name=t;n.updateValue=go;n.notify=ns}function ts(n,t,i){if(ft(t)||t&&t.nodeName&&t.nodeType>0||i.indexOf(n)!==-1)return!1;var r=i.$special;return n&&n.charAt(0)==="$"&&!r[n]?!1:!0}function uf(n){for(var r,t=Object.keys(n.$model?n.$model:n),i=0;i<ei.length;i++)r=t.indexOf(ei[i]),r!==-1&&t.splice(r,1);return t}function rs(n){var t=[],i;t.$id=w();t.$model=n;t.$events={};t.$events[p]=[];t._=it({length:n.length});t._.$watch("length",function(n,i){t.$fire("length",n,i)});for(i in dt)t[i]=dt[i];return avalon.mix(t,or),t}function at(n,t,i,r,u,f,e){for(var c=this.length,o=2,s,h;--o;){switch(n){case"add":s=this.$model.slice(t,t+i).map(function(n){return fu.test(avalon.type(n))?n.$id?n:it(n,0,n):n});hi.apply(this,[t,0].concat(s));this._fire("add",t,i);break;case"del":h=this._splice(t,i);this._fire("del",t,i)}u&&(n=u,t=f,i=e,o=2,u=0)}return this._fire("index",r),this.length!==c&&(this._.length=this.length),h}function sr(n,t){for(var r,u={},i=0,f=t.length;i<f;i++)u[i]=n[i],r=t[i],r in u?(n[i]=u[r],delete u[r]):n[i]=n[r]}function ci(n,t){t.oneTime||n&&avalon.Array.ensure(n,t)&&t.element&&(hf(t,n),new Date-cr>444&&ar())}function hr(n){var f,e,t,i,u,o;if(n&&n.length)for(new Date-cr>444&&typeof n[0]=="object"&&ar(),f=di.call(arguments,1),e=n.length;t=n[--e];)if(i=t.element,i&&i.parentNode)try{u=t.evaluator;t.$repeat?t.handler.apply(t,f):"$repeat"in t||!u?r[t.type](t,t.vmodels):t.type!=="on"&&(o=u.apply(0,t.args||[]),t.handler(o,i,t))}catch(s){avalon.log(s)}}function sf(n,t){return n.uuid||t||(n.uuid=++of),n.uuid}function hf(n,t){var i=n.element;n.uuid||(n.uuid=i.nodeType!==1?n.type+sf(i.parentNode)+"-"+ ++of:n.name+"-"+sf(i));k[n.uuid]||(n.list=t,n.i=~~n.i,k[n.uuid]="__",k.push(n))}function ar(n){for(var t=lr||k.length,i=0;n=k[--t];)if(n.i<7){if(n.element===null){k.splice(t,1);n.list&&(avalon.Array.remove(n.list,n),delete k[n.uuid]);continue}if(n.element&&us(n.element)){if(k.splice(t,1),avalon.Array.remove(n.list,n),cf(n),i++>500){lr=t;break}continue}n.i++;n.i===7&&(n.i=14)}else n.i--;cr=new Date}function cf(n){delete k[n.uuid];n.element=null;n.rollback&&n.rollback();for(var t in n)n[t]=null}function us(n){try{var t=n.parentNode.nodeType}catch(i){return!0}return n.ifRemove&&!h.contains(n.ifRemove)&&d===n.parentNode?(n.parentNode&&n.parentNode.removeChild(n),!0):n.msRetain?0:n.nodeType===1?!h.contains(n):!avalon.contains(h,n)}function af(n){var t=n.nodeName;return t.toLowerCase()===t&&n.scopeName&&n.outerText===""}function ls(n){n.currentStyle.behavior!=="url(#default#VML)"&&(n.style.behavior="url(#default#VML)",n.style.display="inline-block",n.style.zoom=1)}function vf(n){return n.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function li(n){return!n||n.indexOf("-")<0&&n.indexOf("_")<0?n:n.replace(/[-_][^-_]/g,function(n){return n.charAt(1).toUpperCase()})}function yf(n){if(!("classList"in n)){n.classList={node:n};for(var t in vr)n.classList[t.slice(1)]=vr[t]}return n.classList}function pf(n){try{if(typeof n=="object")return n;n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:as.test(n)?avalon.parseJSON(n):n}catch(t){}return n}function bs(n){return n.window&&n.document?n:n.nodeType===9?n.defaultView||n.parentWindow:!1}function df(n,t){var u,i,r;if(n.offsetWidth<=0){if(kf.test(f["@:get"](n,"display"))){u={node:n};for(i in wr)u[i]=n.style[i],n.style[i]=wr[i];t.push(u)}r=n.parentNode;r&&r.nodeType===1&&df(r,t)}}function th(n){var t=n.tagName.toLowerCase();return t==="input"&&/checkbox|radio/.test(n.type)?"checked":t}function lh(n,t,i,r){for(var f=[],o=" = "+i+".",e=n.length,u;u=n[--e];)t.hasOwnProperty(u)&&(f.push(u+o+u),r.vars.push(u),r.type==="duplex"&&(n.get=i+"."+u),n.splice(e,1));return f}function ne(n){for(var t,r,u=[],f={},i=0;i<n.length;i++)t=n[i],r=t&&typeof t.$id=="string"?t.$id:t,f[r]||(f[r]=u.push(t));return u}function dh(n,t){return t=t.replace(yh,"").replace(ph,function(){return"],|"}).replace(wh,function(n,t){return"["+ai(t)}).replace(bh,function(){return'"],["'}).replace(kh,function(){return'",'})+"]","return this.filters.$filter("+n+", "+t+")"}function gh(n,t,i){var c=i.type,y=i.filters||"",a=t.map(function(n){return String(n.$id).replace(vh,"$1")})+n+c+y,s=ch(n).concat(),r=[],e=[],b=[],o="",h,k,p,f,d;for(t=ne(t),i.vars=[],h=0,k=t.length;h<k;h++)s.length&&(p="vm"+v+"_"+h,e.push(p),b.push(t[h]),r.push.apply(r,lh(s,t[h],p,i)));if(r.length||c!=="duplex"){if(c!=="duplex"&&(n.indexOf("||")>-1||n.indexOf("&&")>-1)&&i.vars.forEach(function(t){var i=new RegExp("\\b"+t+"(?:\\.\\w+|\\[\\w+\\])+","ig");n=n.replace(i,function(i,u){var o=i.charAt(t.length),c=n.slice(u+i.length),s=/^\s*\(/.test(c),f,e,h;return o==="."||o==="["||s?(f="var"+String(Math.random()).replace(/^0\./,""),s)?(e=i.split("."),e.length>2?(h=e.pop(),r.push(f+" = "+e.join(".")),f+"."+h):i):(r.push(f+" = "+i),f):i})}),i.args=b,delete i.vars,f=vi.get(a),f){i.evaluator=f;return}if(o=r.join(", "),o&&(o="var "+o),/\S/.test(y)){if(!/text|html/.test(i.type))throw Error("ms-"+i.type+"不支持过滤器");n="\nvar ret"+v+" = "+n+";\r\n"+dh("ret"+v,y);try{f=Function.apply(l,e.concat("'use strict';\n"+o+n));i.evaluator=vi.put(a,function(){return f.apply(avalon,arguments)})}catch(w){u("debug: parse error,"+w.message)}s=r=e=null;return}if(c==="duplex"){d="'use strict';\nreturn function(vvv){\n\t"+o+";\n\tif(!arguments.length){\n\t\treturn "+n+"\n\t}\n\t"+(ah.test(n)?n:s.get)+"= vvv;\n} ";try{f=Function.apply(l,e.concat(d));i.evaluator=vi.put(a,f)}catch(w){u("debug: parse error,"+w.message)}s=r=e=null;return}if(c==="on"){n.indexOf("(")===-1?n+=".call(this, $event)":n=n.replace("(",".call(this,");e.push("$event");n="\nreturn "+n+";";var g=n.lastIndexOf("\nreturn"),nt=n.slice(0,g),tt=n.slice(g);n=nt+"\n"+tt}else n="\nreturn "+n+";";try{f=Function.apply(l,e.concat("'use strict';\n"+o+n));i.evaluator=vi.put(a,f)}catch(w){u("debug: parse error,"+w.message)}s=r=e=null}}function te(n){var i=fi.test(n),t;return i?(t=pe(n),t.length===1)?t[0].value:t.map(function(n){return n.expr?"("+n.value+")":ai(n.value)}).join(" + "):n}function rt(n,t,i,r){n=n||"";gh(n,t,i);i.evaluator&&!r&&(i.handler=a[i.handlerName||i.type],avalon.injectBinding(i))}function re(n,t,i){var r=setTimeout(function(){var u=n.innerHTML;clearTimeout(r);u===i?t():re(n,t,u)})}function ue(n,t){var i=n.getAttribute("avalonctrl")||t.$id;n.setAttribute("avalonctrl",i);t.$events.expr=n.tagName+'[avalonctrl="'+i+'"]'}function kr(n,t){for(var u=0,i;i=n[u++];)i.vmodels=t,r[i.type](i,t),i.evaluator&&i.element&&i.element.nodeType===1&&i.element.removeAttribute(i.name);n.length=0}function uc(n,t){return n.priority-t.priority}function oe(n,t,i){var v=!0,c,l,d,p;if(t.length){var g=le?le(n):n.attributes,h=[],w=[],y={},b={};for(c=0;l=g[c++];)if(l.specified&&(i=l.name.match(nc))){var f=i[1],a=i[2]||"",s=l.value,o=l.name;if(b[o])continue;if(b[o]=1,ic[f]?(a=f,f="on"):rc[f]&&(f==="enabled"&&(u("warning!ms-enabled或ms-attr-enabled已经被废弃"),f="disabled",s="!("+s+")"),a=f,f="attr",o="ms-"+f+"-"+a,w.push([l.name,o,s])),y[o]=s,typeof r[f]=="function"){var k=s.replace(ee,""),nt=s!==k,e={type:f,param:a,element:n,name:o,value:k,oneTime:nt,priority:(tc[f]||f.charCodeAt(0)*10)+(Number(a.replace(/\D/g,""))||0)};f==="html"||f==="text"?(d=ye(s),avalon.mix(e,d),e.filters=e.filters.replace(ve,function(){return e.type="html",e.group=1,""})):f==="duplex"?p=o:o==="ms-if-loop"&&(e.priority+=100);h.push(e);f==="widget"&&(n.msData=n.msData||y)}}if(h.length){for(h.sort(uc),w.forEach(function(t){u("warning!请改用"+t[1]+"代替"+t[0]+"!");n.removeAttribute(t[0]);n.setAttribute(t[1],t[2])}),p&&y["ms-attr-value"]&&!n.scopeName&&n.type==="text"&&u("warning!一个控件不能同时定义ms-attr-value与"+p),c=0;e=h[c];c++){if(f=e.type,se.test(f))return kr(h.slice(0,c+1),t);v&&(v=!he.test(f))}kr(h,t)}}v&&!ie[n.tagName]&&ku.test(n.innerHTML.replace(lc,"<").replace(ac,">"))&&(fe&&fe(n),hc(n,t))}function hc(n,t){var i=avalon.slice(n.childNodes);ni(i,t)}function ni(n,t){for(var r=0,i;i=n[r++];)switch(i.nodeType){case 1:ae(i,t);i.msCallback&&(i.msCallback(),i.msCallback=void 0);break;case 3:fi.test(i.nodeValue)&&pc(i,t,r)}}function ae(n,t,i){var s=n.getAttribute("ms-skip"),f,o,r,e;if(!n.getAttributeNode)return u("warning "+n.tagName+" no getAttributeNode method");if(f=n.getAttributeNode("ms-important"),o=n.getAttributeNode("ms-controller"),typeof s!="string"){if(i=f||o){if(r=avalon.vmodels[i.value],!r)return;t=i===f?[r]:[r].concat(t);e=i.name;n.removeAttribute(e);avalon(n).removeClass(e);ue(n,r)}oe(n,t)}}function ye(n){if(n.indexOf("|")>0){var i=n.replace(vc,function(n){return Array(n.length+1).join("1")}),t=i.replace(cc,"ᄢ㍄").indexOf("|");if(t>-1)return{filters:n.slice(t),value:n.slice(0,t),expr:!0}}return{value:n,filters:"",expr:!0}}function pe(n){var u=[],t,r=0,i;do{if(i=n.indexOf(nt,r),i===-1)break;if(t=n.slice(r,i),t&&u.push({value:t,filters:"",expr:!1}),r=i+nt.length,i=n.indexOf(tt,r),i===-1)break;t=n.slice(r,i);t&&u.push(ye(t.replace(yc,"")));r=i+tt.length}while(1);return t=n.slice(r),t&&u.push({value:t,expr:!1,filters:""}),u}function pc(n,t){var u=[],e=pe(n.data),o,r,f;if(e.length){for(o=0;r=e[o++];)f=i.createTextNode(r.value),r.expr&&(r.value=r.value.replace(ee,function(){return r.oneTime=!0,""}),r.type="text",r.element=f,r.filters=r.filters.replace(ve,function(){return r.type="html",""}),u.push(r)),ct.appendChild(f);n.parentNode.replaceChild(ct,n);u.length&&kr(u,t)}}function kc(n,t,r){var f=n.templateCache&&n.templateCache[t],u,e;if(f){for(u=i.createDocumentFragment();e=f.firstChild;)u.appendChild(e);return u}return avalon.parseHTML(r)}function gr(n){return n==null?"":n}function dc(n,t,i){return t.param.replace(/\w+/g,function(r){var u=avalon.duplexHooks[r];u&&typeof u[i]=="function"&&(n=u[i](n,t))}),n}function gc(){for(var t,n=yt.length-1;n>=0;n--)t=yt[n],t()===!1&&yt.splice(n,1);yt.length||clearInterval(de)}function nl(n){var t=NaN,i=NaN,r;return n.setSelectionRange?(t=n.selectionStart,i=n.selectionEnd):(r=document.selection.createRange(),t=0-r.duplicate().moveStart("character",-1e5),i=t+r.text.length),{start:t,end:i}}function tl(n,t,i){if(n.value&&!n.readOnly)if(n.createTextRange){var r=n.createTextRange();r.collapse(!0);r.moveStart("character",t);r.select()}else n.selectionStart=t,n.selectionEnd=i}function no(n,t,r,u){var f=n.template.cloneNode(!0),s=avalon.slice(f.childNodes),e,o;f.insertBefore(i.createComment(n.signature),f.firstChild);t.appendChild(f);e=[r].concat(n.vmodels);o={nodes:s,vmodels:e};u.push(o)}function il(n){for(var i=[],r=n.element.parentNode.childNodes,u=0,t;t=r[u++];)if(t.nodeValue===n.signature)i.push(t);else if(t.nodeValue===n.signature+":end")break;return i}function iu(n,t,i){for(;;){var r=t.previousSibling;if(!r)break;if(r.parentNode.removeChild(r),i&&i.call(r),r===n)break}}function rl(){var n=it({$key:"",$outer:{},$host:{},$val:{get:function(){return this.$host[this.$key]},set:function(n){this.$host[this.$key]=n}}},{$val:1});return n.$id=w("$proxy$with"),n}function ul(n,t,i){n=n||ru.pop();n?n.$reinitialize():n=rl();var r=i.$repeat;return n.$key=t,n.$host=r,n.$outer=i.$outer,r.$events?n.$events.$val=r.$events[t]:n.$events={},n}function to(n){fl(n)}function fl(n){n.forEach(function(n){io(n,ti)});n.length=0}function el(n){var i={$host:[],$outer:{},$index:0,$first:!1,$last:!1,$remove:avalon.noop},r,t;return i[n]={get:function(){var t=this.$events,i=t.$index;t.$index=t[n];try{return this.$host[this.$index]}finally{t.$index=i}},set:function(n){try{var t=this.$events,i=t.$index;t.$index=[];this.$host.set(this.$index,n)}finally{t.$index=i}}},r={$last:1,$first:1,$index:1},t=it(i,r),t.$id=w("$proxy$each"),t}function ol(n,t){for(var u,f,o,e=t.param||"el",i,r=0,s=ti.length;r<s;r++)u=ti[r],u&&u.hasOwnProperty(e)&&(i=u,ti.splice(r,1));return i||(i=el(e)),f=t.$repeat,o=f.length-1,i.$index=n,i.$first=n===0,i.$last=n===o,i.$host=f,i.$outer=t.$outer,i.$remove=function(){return f.removeAt(i.$index)},i}function io(n,t){var r,i;for(r in n.$events)i=n.$events[r],Array.isArray(i)&&(i.forEach(function(n){typeof n=="object"&&cf(n)}),i.length=0);n.$host=n.$outer={};t.unshift(n)>s.maxRepeatSize&&t.pop()}function ii(n,t){var u="_"+n,r;return ii[u]||(r=i.createElement(n),h.appendChild(r),t=o?getComputedStyle(r,null).display:r.currentStyle.display,h.removeChild(r),ii[u]=t),ii[u]}function ro(n,t,i,r){n=(n+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+n)?+n:0,f=isFinite(+t)?Math.abs(t):3,o=r||",",s=i||".",u="",h=function(n,t){var i=Math.pow(10,t);return""+(Math.round(n*i)/i).toFixed(t)};return u=(f?h(e,f):""+Math.round(e)).split("."),u[0].length>3&&(u[0]=u[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,o)),(u[1]||"").length<f&&(u[1]=u[1]||"",u[1]+=new Array(f-u[1].length+1).join("0")),u.join(s)}function fo(){try{h.doScroll("left");pt()}catch(n){setTimeout(fo)}}var v=new Date-0,i=n.document,ri=i.getElementsByTagName("head")[0],d=ri.insertBefore(document.createElement("avalon"),ri.firstChild),wi,w,b,ft,su,hu,r,a,ui,lu,gi,nr,pu,lt,ir,wu,nt,tt,fi,bu,ku,du,nf,si,fr,ff,er,hi,or,et,ef,lr,c,vr,wr,kf,ie,vt,se,he,we,dr,yi,be,st,de,yt,nu,ge,tu,ru,ti,pi,uu,uo,pt,eo,oo;d.innerHTML="X<style id='avalonStyle'>.avalonHide{ display: none!important }<\/style>";d.setAttribute("ms-skip","1");d.className="avalonHide";wi=/\[native code\]/;var p="$"+v,wt=!1,e=/[^, ]+/g,fu=/^(?:object|array)$/,bi=/^\[object SVG\w*Element\]$/,so=/^\[object (?:Window|DOMWindow|global)\]$/,ki=Object.prototype,g=ki.hasOwnProperty,ht=ki.toString,y=Array.prototype,di=y.slice,o=n.dispatchEvent,h=i.documentElement,ct=i.createDocumentFragment(),bt=i.createElement("div"),eu={};"Boolean Number String Function Array Date RegExp Object Error".replace(e,function(n){eu["[object "+n+"]"]=n.toLowerCase()});w=function(n){return n=n||"avalon",String(Math.random()+Math.random()).replace(/\d\.\d{4}/,n)};b=ho();avalon=function(n){return new avalon.init(n)};avalon.profile=function(){n.console&&avalon.config.profile&&Function.apply.call(console.log,console,arguments)};avalon.nextTick=new function(){function e(){for(var i=t.length,n=0;n<i;n++)t[n]();t=t.slice(i)}var u=n.setImmediate,f=n.MutationObserver,t,r;return u?u.bind(n):(t=[],f)?(r=document.createTextNode("avalon"),new f(e).observe(r,{characterData:!0}),function(n){t.push(n);r.data=Math.random()}):n.VBArray?function(n){t.push(n);var r=i.createElement("script");r.onreadystatechange=function(){e();r.onreadystatechange=null;ri.removeChild(r);r=null};ri.appendChild(r)}:function(n){setTimeout(n,4)}};avalon.init=function(n){this[0]=this.element=n};avalon.fn=avalon.prototype=avalon.init.prototype;avalon.type=function(n){return n==null?String(n):typeof n=="object"||typeof n=="function"?eu[ht.call(n)]||"object":typeof n};ft=typeof alert=="object"?function(n){try{return/^\s*\bfunction\b/.test(n+"")}catch(t){return!1}}:function(n){return ht.call(n)==="[object Function]"};avalon.isFunction=ft;avalon.isWindow=function(n){return n?n==n.document&&n.document!=n:!1};ou(n)&&(avalon.isWindow=ou);for(su in avalon({}))break;hu=su!=="0";avalon.isPlainObject=function(n,t){if(!n||avalon.type(n)!=="object"||n.nodeType||avalon.isWindow(n))return!1;try{if(n.constructor&&!g.call(n,"constructor")&&!g.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(i){return!1}if(hu)for(t in n)return g.call(n,t);for(t in n);return t===void 0||g.call(n,t)};wi.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(n){return ht.call(n)==="[object Object]"&&Object.getPrototypeOf(n)===ki});avalon.mix=avalon.fn.mix=function(){var f,u,i,t,e,o,n=arguments[0]||{},r=1,h=arguments.length,s=!1;for(typeof n=="boolean"&&(s=n,n=arguments[1]||{},r++),typeof n=="object"||ft(n)||(n={}),r===h&&(n=this,r--);r<h;r++)if((f=arguments[r])!=null)for(u in f){i=n[u];try{t=f[u]}catch(c){continue}n!==t&&(s&&t&&(avalon.isPlainObject(t)||(e=Array.isArray(t)))?(e?(e=!1,o=i&&Array.isArray(i)?i:[]):o=i&&avalon.isPlainObject(i)?i:{},n[u]=avalon.mix(s,o,t)):t!==void 0&&(n[u]=t))}return n};avalon.mix({rword:e,subscribers:p,version:1.472,ui:{},log:u,slice:o?function(n,t,i){return di.call(n,t,i)}:function(n,t,i){var f=[],u=n.length,r;if(i===void 0&&(i=u),typeof i=="number"&&isFinite(i))for(t=cu(t,u),i=cu(i,u),r=t;r<i;++r)f[r-t]=n[r];return f},noop:l,error:function(n,t){throw(t||Error)(n);},oneObject:ut,range:function(n,t,i){i||(i=1);t==null&&(t=n||0,n=0);for(var r=-1,u=Math.max(0,Math.ceil((t-n)/i)),f=new Array(u);++r<u;)f[r]=n,n+=i;return f},eventHooks:[],bind:function(n,t,i,r){var e=avalon.eventHooks,u=e[t],f;return typeof u=="object"&&(t=u.type||t,r=u.phase||!!r,i=u.fn?u.fn(n,i):i),f=o?i:function(t){i.call(n,yo(t))},o?n.addEventListener(t,f,r):n.attachEvent("on"+t,f),f},unbind:function(n,t,i,r){var e=avalon.eventHooks,u=e[t],f=i||l;typeof u=="object"&&(t=u.type||t,r=u.phase||!!r);o?n.removeEventListener(t,f,r):n.detachEvent("on"+t,f)},css:function(n,t,i){var r,u,e;if(n instanceof avalon&&(n=n[0]),r=/[_-]/.test(t)?li(t):t,t=avalon.cssName(r)||r,i===void 0||typeof i=="boolean")return u=f[r+":get"]||f["@:get"],t==="background"&&(t="backgroundColor"),e=u(n,t),i===!0?parseFloat(e)||0:e;if(i==="")n.style[t]="";else{if(i==null||i!==i)return;isFinite(i)&&!avalon.cssNumber[r]&&(i+="px");u=f[r+":set"]||f["@:set"];u(n,t,i)}},each:function(n,t){var i,r;if(n)if(i=0,co(n)){for(r=n.length;i<r;i++)if(t(i,n[i])===!1)break}else for(i in n)if(n.hasOwnProperty(i)&&t(i,n[i])===!1)break},getWidgetData:function(n,t){var r=avalon(n).data(),u={};for(var i in r)i.indexOf(t)===0&&(u[i.replace(t,"").replace(/\w/,function(n){return n.toLowerCase()})]=r[i]);return u},Array:{ensure:function(n,t){if(n.indexOf(t)===-1)return n.push(t)},removeAt:function(n,t){return!!n.splice(t,1).length},remove:function(n,t){var i=n.indexOf(t);return~i?avalon.Array.removeAt(n,i):!1}}});r=avalon.bindingHandlers={};a=avalon.bindingExecutors={};ui=new function(){function t(n){this.size=0;this.limit=n;this.head=this.tail=void 0;this._keymap={}}var n=t.prototype;return n.put=function(n,t){var i={key:n,value:t};return this._keymap[n]=i,this.tail?(this.tail.newer=i,i.older=this.tail):this.head=i,this.tail=i,this.size===this.limit?this.shift():this.size++,t},n.shift=function(){var n=this.head;n&&(this.head=this.head.newer,this.head.older=n.newer=n.older=this._keymap[n.key]=void 0,delete this._keymap[n.key])},n.get=function(n){var t=this._keymap[n];if(t!==void 0)return t===this.tail?t.value:(t.newer&&(t===this.head&&(this.head=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.tail,this.tail&&(this.tail.newer=t),this.tail=t,t.value)},t};"司徒正美".trim||(lu=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,String.prototype.trim=function(){return this.replace(lu,"")});var lo=!{toString:null}.propertyIsEnumerable("toString"),ao=function(){}.propertyIsEnumerable("prototype"),au=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],vo=au.length;if(Object.keys||(Object.keys=function(n){var t=[],s=ao&&typeof n=="function",i,r,e,o,u,f;if(typeof n=="string"||n&&n.callee)for(i=0;i<n.length;++i)t.push(String(i));else for(r in n)s&&r==="prototype"||!g.call(n,r)||t.push(String(r));if(lo)for(e=n.constructor,o=e&&e.prototype===n,u=0;u<vo;u++)f=au[u],o&&f==="constructor"||!g.call(n,f)||t.push(f);return t}),Array.isArray||(Array.isArray=function(n){return ht.call(n)==="[object Array]"}),l.bind||(Function.prototype.bind=function(n){if(arguments.length<2&&n===void 0)return this;var i=this,t=arguments;return function(){for(var u=[],r=1;r<t.length;r++)u.push(t[r]);for(r=0;r<arguments.length;r++)u.push(arguments[r]);return i.apply(n,u)}}),wi.test([].map)||avalon.mix(y,{indexOf:function(n,t){var r=this.length,i=~~t;for(i<0&&(i+=r);i<r;i++)if(this[i]===n)return i;return-1},lastIndexOf:function(n,t){var r=this.length,i=t==null?r-1:t;for(i<0&&(i=Math.max(0,r+i));i>=0;i--)if(this[i]===n)return i;return-1},forEach:kt("","_",""),filter:kt("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:kt("r=[],","r[i]=_","return r"),some:kt("","if(_)return true","return false"),every:kt("","if(!_)return false","return true")}),avalon.contains=vu,i.contains||(i.contains=function(n){return vu(i,n)}),n.SVGElement&&(i.createTextNode("x").contains||(Node.prototype.contains=function(n){return!!(this.compareDocumentPosition(n)&16)}),gi="http://www.w3.org/2000/svg",nr=i.createElementNS(gi,"svg"),nr.innerHTML='<circle cx="50" cy="50" r="40" fill="red" />',!bi.test(nr.firstChild))){function tr(n,t){var f,e,r,u;if(n&&n.childNodes)for(f=n.childNodes,e=0;r=f[e++];)r.tagName&&(u=i.createElementNS(gi,r.tagName.toLowerCase()),y.forEach.call(r.attributes,function(n){u.setAttribute(n.name,n.value)}),tr(r,u),t.appendChild(u))}Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:yu,set:function(n){var f=this.tagName.toLowerCase(),t=this.parentNode,u=avalon.parseHTML(n),r;f==="svg"?t.insertBefore(u,this):(r=i.createDocumentFragment(),tr(u,r),t.insertBefore(r,this));t.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var n=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),i=new RegExp("<\/"+this.nodeName+">$","i");return n.replace(t,"").replace(i,"")},set:function(n){if(avalon.clearHTML){avalon.clearHTML(this);var t=avalon.parseHTML(n);tr(t,this)}}}})}!h.outerHTML&&n.HTMLElement&&HTMLElement.prototype.__defineGetter__("outerHTML",yu);pu=/^(?:mouse|contextmenu|drag)|click/;lt=avalon.eventHooks;"onmouseenter"in h||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(n,t){lt[n]={type:t,fn:function(t,i){return function(r){var u=r.relatedTarget;if(!u||u!==t&&!(t.compareDocumentPosition(u)&16))return delete r.type,r.type=n,i.call(t,r)}}}});avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(t,i){n[t]&&!lt.animationend&&(lt.animationend={type:i})});"oninput"in i.createElement("input")||(lt.input={type:"propertychange",fn:function(n,t){return function(i){if(i.propertyName==="value")return i.type="input",t.call(n,i)}}});i.onmousewheel===void 0&&(ir=i.onwheel!==void 0?"wheel":"DOMMouseScroll",wu=ir==="wheel"?"deltaY":"detail",lt.mousewheel={type:ir,fn:function(n,t){return function(i){i.wheelDeltaY=i.wheelDelta=i[wu]>0?-120:120;i.wheelDeltaX=0;Object.defineProperty&&Object.defineProperty(i,"type",{value:"mousewheel"});t.call(n,i)}}});du=/[-.*+?^${}()|[\]\/\\]/g;nf={interpolate:function(n){var r,t,i;if(nt=n[0],tt=n[1],nt===tt)throw new SyntaxError("openTag===closeTag");else{if(r=nt+"test"+tt,bt.innerHTML=r,bt.innerHTML!==r&&bt.innerHTML.indexOf("&lt;")>-1)throw new SyntaxError("此定界符不合法");s.openTag=nt;s.closeTag=tt;bt.innerHTML=""}t=gu(nt);i=gu(tt);fi=new RegExp(t+"([\\s\\S]*)"+i);bu=new RegExp(t+"([\\s\\S]*)"+i,"g");ku=new RegExp(t+"[\\s\\S]*"+i+"|\\sms-")}};s.debug=!0;s.plugins=nf;s.plugins.interpolate(["{{","}}"]);s.paths={};s.shim={};s.maxRepeatSize=100;avalon.config=s;var po=/(\w+)\[(avalonctrl)="(\S+)"\]/,tf=i.querySelectorAll?function(n){return i.querySelectorAll(n)}:function(n){for(var t=n.match(po),f=i.getElementsByTagName(t[1]),u=[],e=0,r;r=f[e++];)r.getAttribute(t[2])===t[3]&&u.push(r);return u},dt={$watch:function(n,t){if(typeof t=="function"){var i=this.$events[n];i?i.push(t):this.$events[n]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(n,t){var u=arguments.length,i,r;if(u===0)this.$watch.backup=this.$events,this.$events={};else if(u===1)this.$events[n]=[];else for(i=this.$events[n]||[],r=i.length;~--r<0;)if(i[r]===t)return i.splice(r,1);return this},$fire:function(n){var f,t,r,u,e,s,h,c,l,a,o,v,p;if(/^(\w+)!(\S+)$/.test(n)&&(f=RegExp.$1,n=RegExp.$2),e=this.$events,e)if(s=di.call(arguments,1),h=[n].concat(s),f==="all")for(t in avalon.vmodels)r=avalon.vmodels[t],r!==this&&r.$fire.apply(r,h);else if(f==="up"||f==="down"){if(c=e.expr?tf(e.expr):[],c.length===0)return;for(t in avalon.vmodels)if(r=avalon.vmodels[t],r!==this&&r.$events.expr){if(l=tf(r.$events.expr),l.length===0)continue;y.forEach.call(l,function(n){y.forEach.call(c,function(t){var i=f==="down"?t.contains(n):n.contains(t);i&&(n._avalon=r)})})}for(a=i.getElementsByTagName("*"),o=[],y.forEach.call(a,function(n){n._avalon&&(o.push(n._avalon),n._avalon="",n.removeAttribute("_avalon"))}),f==="up"&&o.reverse(),t=0;u=o[t++];)if(u.$fire.apply(u,h)===!1)break}else{for(v=e[n]||[],p=e.$all||[],t=0;u=v[t++];)ft(u)&&u.apply(this,s);for(t=0;u=p[t++];)ft(u)&&u.apply(this,arguments)}}},rf=avalon.vmodels={};avalon.define=function(n,t){var i=n.$id||n,r,f;return i||u("warning: vm必须指定$id"),rf[i]&&u("warning: "+i+" 已经存在于avalon.vmodels中"),typeof n=="object"?r=it(n):(f={$watch:l},t(f),r=it(f),wt=!0,t(r),wt=!1),r.$id=i,rf[i]=r};var ei=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray,$reinitialize").match(e),rr=Object.defineProperty,oi=!0;try{rr({},"_",{value:"x"});si=Object.defineProperties}catch(pl){oi=!1}if(fr=Object.is||function(n,t){return n===0&&t===0?1/n==1/t:n!==n?t!==t:n===t},ff=o?function(n){var i={};for(var t in n)i[t]={get:n[t],set:n[t],enumerable:!0,configurable:!0};return i}:function(n){return n},!oi&&("__defineGetter__"in avalon&&(rr=function(n,t,i){return"value"in i&&(n[t]=i.value),"get"in i&&n.__defineGetter__(t,i.get),"set"in i&&n.__defineSetter__(t,i.set),n},si=function(n,t){for(var i in t)t.hasOwnProperty(i)&&rr(n,i,t[i]);return n}),b)){er={};n.execScript("Function parseVB(code)\n\tExecuteGlobal(code)\nEnd Function","VBScript");function is(n,t,i,r){var u=t[i];if(arguments.length===4)u.call(n,r);else return u.call(n)}si=function(t,i,r){var f=[],e,u;f.push("\r\n\tPrivate [__data__], [__proxy__]","\tPublic Default Function [__const__](d"+v+", p"+v+")","\t\tSet [__data__] = d"+v+": set [__proxy__] = p"+v,"\t\tSet [__const__] = Me","\tEnd Function");for(t in r)i.hasOwnProperty(t)||f.push("\tPublic ["+t+"]");ei.forEach(function(n){i.hasOwnProperty(n)||f.push("\tPublic ["+n+"]")});f.push("\tPublic [hasOwnProperty]");for(t in i)f.push("\tPublic Property Let ["+t+"](val"+v+")",'\t\tCall [__proxy__](Me,[__data__], "'+t+'", val'+v+")","\tEnd Property","\tPublic Property Set ["+t+"](val"+v+")",'\t\tCall [__proxy__](Me,[__data__], "'+t+'", val'+v+")","\tEnd Property","\tPublic Property Get ["+t+"]","\tOn Error Resume Next","\t\tSet["+t+'] = [__proxy__](Me,[__data__],"'+t+'")',"\tIf Err.Number <> 0 Then","\t\t["+t+'] = [__proxy__](Me,[__data__],"'+t+'")',"\tEnd If","\tOn Error Goto 0","\tEnd Property");return f.push("End Class"),e=f.join("\r\n"),u=er[e],u||(u=w("VBClass"),n.parseVB("Class "+u+e),n.parseVB(["Function "+u+"Factory(a, b)","\tDim o","\tSet o = (New "+u+")(a, b)","\tSet "+u+"Factory = o","End Function"].join("\r\n")),er[e]=u),n[u+"Factory"](i,is)}}hi=y.splice;or={_splice:hi,_fire:function(n,t,i){hr(this.$events[p],n,t,i)},size:function(){return this._.length},pushArray:function(n){var t=n.length,i=this.length;return t&&(y.push.apply(this.$model,n),at.call(this,"add",i,t,Math.max(0,i-1))),t+i},push:function(){for(var t=[],i=arguments.length,n=0;n<i;n++)t[n]=arguments[n];return this.pushArray(t)},unshift:function(){var n=arguments.length,t=this.length;return n&&(y.unshift.apply(this.$model,arguments),at.call(this,"add",0,n,0)),n+t},shift:function(){if(this.length){var n=this.$model.shift();return at.call(this,"del",0,1,0),n}},pop:function(){var n=this.length,t;if(n)return t=this.$model.pop(),at.call(this,"del",n-1,1,Math.max(0,n-2)),t},splice:function(n){var r=arguments.length,t=[],i,u=hi.apply(this.$model,arguments);return u.length&&(t.push("del",n,u.length,0),i=!0),r>2&&(i?t.splice(3,1,0,"add",n,r-2):t.push("add",n,r-2,0),i=!0),i?at.apply(this,t):[]},contains:function(n){return this.indexOf(n)!==-1},remove:function(n){return this.removeAt(this.indexOf(n))},removeAt:function(n){return n>=0?(this.$model.splice(n,1),at.call(this,"del",n,1,0)):[]},clear:function(){return this.$model.length=this.length=this._.length=0,this._fire("clear",0),this},removeAll:function(n){var t,i;if(Array.isArray(n))for(t=this.length-1;t>=0;t--)n.indexOf(this[t])!==-1&&this.removeAt(t);else if(typeof n=="function")for(t=this.length-1;t>=0;t--)i=this[t],n(i,t)&&this.removeAt(t);else this.clear()},ensure:function(n){return this.contains(n)||this.push(n),this},set:function(n,t){var u,i,r;if(n<this.length&&n>-1)if(u=avalon.type(t),t&&t.$model&&(t=t.$model),i=this[n],u==="object")for(r in t)i.hasOwnProperty(r)&&(i[r]=t[r]);else u==="array"?i.clear().push.apply(i,t):i!==t&&(this[n]=t,this.$model[n]=t,this._fire("set",n,t));return this}};"sort,reverse".replace(e,function(n){or[n]=function(){var u=this.$model,i=u.concat(),c=Math.random(),r=[],o,t,s,f,h,e;for(y[n].apply(u,arguments),t=0,s=i.length;t<s;t++)f=u[t],h=i[t],fr(f,h)?r.push(t):(e=i.indexOf(f),r.push(e),i[e]=c,o=!0);return o&&(sr(this,r),this._fire("move",r),this._fire("index",0)),this}});et=function(){var t=[],n;return{begin:function(i){t.push(n);n=i},end:function(){n=t.pop()},collectDependency:function(t,i){n&&n.callback(t,i)}}}();ef=/^(duplex|on)$/;avalon.injectBinding=function(n){var f=n.evaluator,r,t,e;if(f){et.begin({callback:function(t,i){ci(t.$events[i._name],n)}});try{r=ef.test(n.type)?n:f.apply(0,n.args);r===void 0&&delete n.evaluator;n.handler&&n.handler(r,n.element,n)}catch(o){u("warning:exception throwed in [avalon.injectBinding] ",o);delete n.evaluator;t=n.element;t&&t.nodeType===3&&(e=t.parentNode,s.commentInterpolate?e.replaceChild(i.createComment(n.value),t):t.data=nt+(n.oneTime?"::":"")+n.value+tt)}finally{et.end()}}};var of=0,k=avalon.$$subscribers=[],cr=new Date;lr=0;c={area:[1,"<map>","<\/map>"],param:[1,"<object>","<\/object>"],col:[2,"<table><colgroup>","<\/colgroup><\/table>"],legend:[1,"<fieldset>","<\/fieldset>"],option:[1,"<select multiple='multiple'>","<\/select>"],thead:[1,"<table>","<\/table>"],tr:[2,"<table>","<\/table>"],td:[3,"<table><tr>","<\/tr><\/table>"],g:[1,'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">',"<\/svg>"],_default:o?[0,"",""]:[1,"X<div>","<\/div>"]};c.th=c.td;c.optgroup=c.option;c.tbody=c.tfoot=c.colgroup=c.caption=c.thead;String("circle,defs,ellipse,image,line,path,polygon,polyline,rect,symbol,text,use").replace(e,function(n){c[n]=c.g});var fs=/<([\w:]+)/,es=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,lf=o?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/ig,os=ut(["","text/javascript","text/ecmascript","application/ecmascript","application/javascript"]),ss=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,hs=i.createElement("script"),cs=/<|&#?\w+;/;avalon.parseHTML=function(n){var e=ct.cloneNode(!1),r,f,t,h,p;if(typeof n!="string")return e;if(!cs.test(n))return e.appendChild(i.createTextNode(n)),e;n=n.replace(es,"<$1><\/$2>").trim();var a=(fs.exec(n)||["",""])[1].toLowerCase(),l=c[a]||c._default,u=bt,v,s;if(o||(n=n.replace(lf,"<br class=msNoScope>$1")),u.innerHTML=l[1]+n+l[2],r=u.getElementsByTagName("script"),r.length)for(f=0;t=r[f++];)os[t.type]&&(s=hs.cloneNode(!1),y.forEach.call(t.attributes,function(n){n&&n.specified&&(s[n.name]=n.value,s.setAttribute(n.name,n.value))}),s.text=t.text,t.parentNode.replaceChild(s,t));if(!o){if(h=l[1]==="X<div>"?u.lastChild.firstChild:u.lastChild,h&&h.tagName==="TABLE"&&a!=="tbody")for(r=h.childNodes,f=0;t=r[f++];)if(t.tagName==="TBODY"&&!t.innerHTML){h.removeChild(t);break}for(r=u.getElementsByTagName("br"),p=r.length;t=r[--p];)t.className==="msNoScope"&&t.parentNode.removeChild(t);for(r=u.all,f=0;t=r[f++];)af(t)&&ls(t)}for(f=l[0];f--;u=u.lastChild);while(v=u.firstChild)e.appendChild(v);return e};avalon.innerHTML=function(n,t){if(!o&&!lf.test(t)&&!ss.test(t))try{n.innerHTML=t;return}catch(r){}var i=this.parseHTML(t);this.clearHTML(n).appendChild(i)};avalon.clearHTML=function(n){for(n.textContent="";n.firstChild;)n.removeChild(n.firstChild);return n};vr={_toString:function(){var t=this.node,n=t.className,i=typeof n=="string"?n:n.baseVal;return i.split(/\s+/).join(" ")},_contains:function(n){return(" "+this+" ").indexOf(" "+n+" ")>-1},_add:function(n){this.contains(n)||this._set(this+" "+n)},_remove:function(n){this._set((" "+this+" ").replace(" "+n+" "," "))},__set:function(n){n=n.trim();var t=this.node;bi.test(t)?t.setAttribute("class",n):t.className=n}};"add,remove".replace(e,function(n){avalon.fn[n+"Class"]=function(t){var i=this[0];return t&&typeof t=="string"&&i&&i.nodeType===1&&t.replace(/\S+/g,function(t){yf(i)[n](t)}),this}});avalon.fn.mix({hasClass:function(n){var t=this[0]||{};return t.nodeType===1&&yf(t).contains(n)},toggleClass:function(n,t){for(var i,u=0,f=String(n).split(/\s+/),e=typeof t=="boolean",r;i=f[u++];)r=e?t:!this.hasClass(i),this[r?"addClass":"removeClass"](i);return this},attr:function(n,t){return arguments.length===2?(this[0].setAttribute(n,t),this):this[0].getAttribute(n)},data:function(n,t){var r,i;n="data-"+vf(n||"");switch(arguments.length){case 2:return this.attr(n,t),this;case 1:return r=this.attr(n),pf(r);case 0:return i={},y.forEach.call(this[0].attributes,function(t){t&&(n=t.name,n.indexOf("data-")||(n=li(n.slice(5)),i[n]=pf(t.value)))}),i}},removeData:function(n){return n="data-"+vf(n),this[0].removeAttribute(n),this},css:function(n,t){var i,r;if(avalon.isPlainObject(n))for(i in n)avalon.css(this,i,n[i]);else r=avalon.css(this,n,t);return r!==void 0?r:this},position:function(){var n,i,r=this[0],t={top:0,left:0};if(r)return this.css("position")==="fixed"?i=r.getBoundingClientRect():(n=this.offsetParent(),i=this.offset(),n[0].tagName!=="HTML"&&(t=n.offset()),t.top+=avalon.css(n[0],"borderTopWidth",!0),t.left+=avalon.css(n[0],"borderLeftWidth",!0),t.top-=n.scrollTop(),t.left-=n.scrollLeft()),{top:i.top-t.top-avalon.css(r,"marginTop",!0),left:i.left-t.left-avalon.css(r,"marginLeft",!0)}},offsetParent:function(){for(var n=this[0].offsetParent;n&&avalon.css(n,"position")==="static";)n=n.offsetParent;return avalon(n||h)},bind:function(n,t,i){if(this[0])return avalon.bind(this[0],n,t,i)},unbind:function(n,t,i){return this[0]&&avalon.unbind(this[0],n,t,i),this},val:function(n){var t=this[0],u;if(t&&t.nodeType===1){var i=arguments.length===0,f=i?":get":":set",r=br[th(t)+f];if(r)u=r(t,n);else{if(i)return(t.value||"").replace(/\r/g,"");t.value=n}}return i?u:this}});var as=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,vs=/^[\],:{}\s]*$/,ys=/(?:^|:|,)(?:\s*\[)+/g,ps=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,ws=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g;avalon.parseJSON=n.JSON?JSON.parse:function(n){if(typeof n=="string"){if(n=n.trim(),n&&vs.test(n.replace(ps,"@").replace(ws,"]").replace(ys,"")))return new Function("return "+n)();avalon.error("Invalid JSON: "+n)}return n};avalon.fireDom=function(n,t,r){if(i.createEvent){var u=i.createEvent("Events");u.initEvent(t,!0,!0);avalon.mix(u,r);n.dispatchEvent(u)}else try{u=i.createEventObject();avalon.mix(u,r);n.fireEvent("on"+t,u)}catch(f){}};avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,t){avalon.fn[n]=function(i){var u=this[0]||{},r=bs(u),f=n==="scrollTop";if(arguments.length)r?r.scrollTo(f?avalon(r).scrollLeft():i,f?i:avalon(r).scrollTop()):u[n]=i;else return r?t in r?r[t]:h[n]:u[n]}});var f=avalon.cssHooks={},wf=["","-webkit-","-o-","-moz-","-ms-"],yr={float:o?"cssFloat":"styleFloat"};if(avalon.cssNumber=ut("animationIterationCount,columnCount,order,flex,flexGrow,flexShrink,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(n,t,i){if(yr[n])return yr[n];t=t||h.style;for(var r=0,u=wf.length;r<u;r++)if(i=li(wf[r]+n),i in t)return yr[n]=i;return null},f["@:set"]=function(n,t,i){try{n.style[t]=i}catch(r){}},n.getComputedStyle)f["@:get"]=function(n,t){if(!n||!n.style)throw new Error("getComputedStyle要求传入一个节点 "+n);var i,r=getComputedStyle(n,null);return r&&(i=t==="filter"?r.getPropertyValue(t):r[t],i===""&&(i=n.style[t])),i},f["opacity:get"]=function(n){var t=f["@:get"](n,"opacity");return t===""?"1":t};else{var ks=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,ds=/^(top|right|bottom|left)$/,bf=/alpha\([^)]*\)/i,pr=!!n.XDomainRequest,gs="DXImageTransform.Microsoft.Alpha",nh={thin:pr?"1px":"2px",medium:pr?"3px":"4px",thick:pr?"5px":"6px"};f["@:get"]=function(n,t){var u=n.currentStyle,i=u[t];if(ks.test(i)&&!ds.test(i)){var r=n.style,f=r.left,e=n.runtimeStyle.left;n.runtimeStyle.left=u.left;r.left=t==="fontSize"?"1em":i||0;i=r.pixelLeft+"px";r.left=f;n.runtimeStyle.left=e}return i==="medium"&&(t=t.replace("Width","Style"),u[t]==="none"&&(i="0px")),i===""?"auto":nh[i]||i};f["opacity:set"]=function(n,t,i){var r=n.style,f=isFinite(i)&&i<=1?"alpha(opacity="+i*100+")":"",u=r.filter||"";r.zoom=1;r.filter=(bf.test(u)?u.replace(bf,f):u+" "+f).trim();r.filter||r.removeAttribute("filter")};f["opacity:get"]=function(n){var t=n.filters.alpha||n.filters[gs],i=t&&t.enabled?t.opacity:100;return i/100+""}}"top,left".replace(e,function(n){f[n+":get"]=function(t){var i=f["@:get"](t,n);return/px$/.test(i)?i:avalon(t).position()[n]+"px"}});wr={position:"absolute",visibility:"hidden",display:"block"};kf=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(e,function(n){var t=n.toLowerCase(),i="client"+n,u="scroll"+n,r="offset"+n;f[t+":get"]=function(t,i,u){var e=-4,f;return(typeof u=="number"&&(e=u),i=n==="Width"?["Left","Right"]:["Top","Bottom"],f=t[r],e===2)?f+avalon.css(t,"margin"+i[0],!0)+avalon.css(t,"margin"+i[1],!0):(e<0&&(f=f-avalon.css(t,"border"+i[0]+"Width",!0)-avalon.css(t,"border"+i[1]+"Width",!0)),e===-4&&(f=f-avalon.css(t,"padding"+i[0],!0)-avalon.css(t,"padding"+i[1],!0)),f)};f[t+"&get"]=function(n){var u=[],e,o,i,r;for(df(n,u),e=f[t+":get"](n),o=0;i=u[o++];){n=i.node;for(r in i)typeof i[r]=="string"&&(n.style[r]=i[r])}return e};avalon.fn[t]=function(e){var o=this[0],s;return arguments.length===0?o.setTimeout?o["inner"+n]||o.document.documentElement[i]||o.document.body[i]:o.nodeType===9?(s=o.documentElement,Math.max(o.body[u],s[u],o.body[r],s[r],s[i])):f[t+"&get"](o):this.css(t,e)};avalon.fn["inner"+n]=function(){return f[t+":get"](this[0],void 0,-2)};avalon.fn["outer"+n]=function(n){return f[t+":get"](this[0],void 0,n===!0?2:0)}});avalon.fn.offset=function(){var n=this[0],t={left:0,top:0};if(!n||!n.tagName||!n.ownerDocument)return t;var r=n.ownerDocument,u=r.body,i=r.documentElement,f=r.defaultView||r.parentWindow;if(!avalon.contains(i,n))return t;n.getBoundingClientRect&&(t=n.getBoundingClientRect());var e=i.clientTop||u.clientTop,o=i.clientLeft||u.clientLeft,s=Math.max(f.pageYOffset||0,i.scrollTop,u.scrollTop),h=Math.max(f.pageXOffset||0,i.scrollLeft,u.scrollLeft);return{top:t.top+s-e,left:t.left+h-o}};var ih=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,br={"option:get":b?function(n){return ih.test(n.outerHTML)?n.value:n.text.trim()}:function(n){return n.value},"select:get":function(n,t){for(var r,e=n.options,i=n.selectedIndex,h=br["option:get"],u=n.type==="select-one"||i<0,o=u?null:[],s=u?i+1:e.length,f=i<0?s:u?i:0;f<s;f++)if(r=e[f],(r.selected||f===i)&&!r.disabled){if(t=h(r),u)return t;o.push(t)}return o},"select:set":function(n,t,i){var u,f,r;for(t=[].concat(t),u=br["option:get"],f=0;r=n.options[f++];)(r.selected=t.indexOf(u(r))>-1)&&(i=!0);i||(n.selectedIndex=-1)}},rh={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},ai=n.JSON&&JSON.stringify||function(n){return'"'+n.replace(/[\\\"\x00-\x1f]/g,function(n){var t=rh[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"'},uh="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",fh=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,eh=/[^\w$]+/g,oh=new RegExp(["\\b"+uh.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),sh=/\b\d[^,]*/g,hh=/^,+|,+$/g,gf=new ui(512),ch=function(n){var t=","+n.trim(),i=gf.get(t),r;return i?i:(r=n.replace(fh,"").replace(eh,",").replace(oh,"").replace(sh,"").replace(hh,"").split(/^$|,+/),gf.put(t,ne(r)))};var vi=new ui(128),ah=/\w\[.*\]|\w\.\w/,vh=/(\$proxy\$[a-z]+)\d+$/,yh=/\)\s*$/,ph=/\)\s*\|/g,wh=/\|\s*([$\w]+)/g,bh=/"\s*\["g,kh=/"\s*\(/g;avalon.parseExprProxy=rt;avalon.scan=function(n,t){n=n||h;var i=t?[].concat(t):[];ae(n,i)};ie=ut("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase());vt=function(n,t,i){var r=n.getAttribute(t),f,u;if(r)for(f=0;u=i[f++];)if(u.hasOwnProperty(r)&&typeof u[r]=="function")return u[r]};var fe=b&&n.MutationObserver?function(n){for(var t=n.firstChild,i,r;t;)r=t.nextSibling,t.nodeType===3?i?(i.nodeValue+=t.nodeValue,n.removeChild(t)):i=t:i=null,t=r}:0,ee=/^\s*::/,nc=/ms-(\w+)-?(.*)/,tc={"if":10,repeat:90,data:100,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},ic=ut("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scan,scroll,submit"),rc=ut("value,title,alt,checked,selected,disabled,readonly,enabled");if(se=/^if|widget|repeat$/,he=/^each|with|html|include$/,!o)var ce=new ui(512),fc=/\s+(ms-[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ec=/^['"]/,oc=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,sc=/&amp;/g,le=function(n){var r=n.outerHTML,t,u,f,i,e,o,s;if(r.slice(0,2)==="<\/"||!r.trim())return[];if(t=r.match(oc)[0],t.slice(-1)===">"&&(t=t.slice(0,-1)),u=[],e=ce.get(t),e)return e;while(f=fc.exec(t))i=f[2],i&&(i=(ec.test(i)?i.slice(1,-1):i).replace(sc,"&")),o=f[1].toLowerCase(),s={name:o,specified:!0,value:i||""},u.push(s);return ce.put(t,u)};var ve=/\|\s*html(?:\b|$)/,cc=/\|\|/g,lc=/&lt;/g,ac=/&gt;/g,vc=/(['"])(\\\1|.)+?\1/g,yc=/\r?\n/g;we="autofocus,autoplay,async,allowTransparency,checked,controls,declare,disabled,defer,defaultChecked,defaultSelected,contentEditable,isMap,loop,multiple,noHref,noResize,noShade,open,readOnly,selected";dr={};we.replace(e,function(n){dr[n.toLowerCase()]=n});yi={"accept-charset":"acceptCharset",char:"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"};be="accessKey,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan,dateTime,defaultValue,frameBorder,longDesc,maxLength,marginWidth,marginHeight,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign";be.replace(e,function(n){yi[n.toLowerCase()]=n});var wc=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/img,bc=/<noscript.*?>([\s\S]+?)<\/noscript>/im,ke=function(){return new(n.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},ot=avalon.templateCache={};r.attr=function(n,t){var f=te(n.value.trim()),r,u;n.type==="include"&&(r=n.element,n.includeRendered=vt(r,"data-include-rendered",t),n.includeLoaded=vt(r,"data-include-loaded",t),u=n.includeReplace=!!avalon(r).data("includeReplace"),avalon(r).data("includeCache")&&(n.templateCache={}),n.startInclude=i.createComment("ms-include"),n.endInclude=i.createComment("ms-include-end"),u?(n.element=n.startInclude,r.parentNode.insertBefore(n.startInclude,r),r.parentNode.insertBefore(n.endInclude,r.nextSibling)):(r.insertBefore(n.startInclude,r.firstChild),r.appendChild(n.endInclude)));n.handlerName="attr";rt(f,t,n)};a.attr=function(t,r,u){var c=u.type,e=u.param,p,w,g,f,s,a,y,b,k;if(c==="css")avalon(r).css(e,t);else if(c==="attr"){if(p=t===!1||t===null||t===void 0,!o&&yi[e]&&(e=yi[e]),w=dr[e],typeof r[w]=="boolean"&&(r[w]=!!t,t||(p=!0)),p)return r.removeAttribute(e);g=bi.test(r)?!1:i.namespaces&&af(r)?!0:e in r.cloneNode(!1);g?r[e]=t+"":r.setAttribute(e,t)}else if(c==="include"&&t){var nt=u.vmodels,tt=u.includeRendered,it=u.includeLoaded,ut=u.includeReplace,l=ut?r.parentNode:r,v=function(n){var o,f,r,e,s,h;if(u.vmodels!==null){for(it&&(o=it.apply(l,[n].concat(nt)),typeof o=="string"&&(n=o)),tt&&re(l,function(){tt.call(l)},NaN),f=u.includeLastID,u.templateCache&&f&&f!==t&&(r=u.templateCache[f],r||(r=u.templateCache[f]=i.createElement("div"),d.appendChild(r))),u.includeLastID=t;u.startInclude;)if(e=u.startInclude.nextSibling,e&&e!==u.endInclude)l.removeChild(e),r&&r.appendChild(e);else break;s=kc(u,t,n);h=avalon.slice(s.childNodes);l.insertBefore(s,u.endInclude);ni(h,nt)}};if(u.param==="src")typeof ot[t]=="string"?avalon.nextTick(function(){v(ot[t])}):Array.isArray(ot[t])?ot[t].push(v):(f=ke(),f.onreadystatechange=function(){var n,i,r,u;if(f.readyState===4&&(n=f.status,n>=200&&n<300||n===304||n===1223)){for(i=f.responseText,r=0;u=ot[t][r++];)u(i);ot[t]=i}},ot[t]=[v],f.open("GET",t,!0),"withCredentials"in f&&(f.withCredentials=!0),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.send(null));else if(s=t&&t.nodeType===1?t:i.getElementById(t),s){if(s.tagName==="NOSCRIPT"&&!(s.innerHTML||s.fixIE78)){f=ke();f.open("GET",location,!1);f.send(null);var ft=i.getElementsByTagName("noscript"),rt=(f.responseText||"").match(wc)||[],et=rt.length;for(a=0;a<et;a++)y=ft[a],y&&(y.style.display="none",y.fixIE78=(rt[a].match(bc)||["","&nbsp;"])[1])}avalon.nextTick(function(){v(s.fixIE78||s.value||s.innerText||s.innerHTML)})}}else h.hasAttribute||typeof t!="string"||c!=="src"&&c!=="href"||(t=t.replace(/&amp;/g,"&")),r[c]=t,n.chrome&&r.tagName==="EMBED"&&(b=r.parentNode,k=document.createComment("ms-src"),b.replaceChild(k,r),b.replaceChild(r,k))};"title,alt,src,value,css,include,href".replace(e,function(n){r[n]=r.attr});r["class"]=function(n,t){var f=n.param,r=n.value,s,e,u,o,a,v,y;if(n.handlerName="class",!f||isFinite(f)?(n.param="",e=r.replace(bu,function(n){return n.replace(/./g,"0")}).indexOf(":"),e===-1?(u=r,s=!0):(u=r.slice(0,e),s=r.slice(e+1)),u=fi.test(r)?te(u):ai(u),n.expr="["+u+","+s+"]"):(n.expr="["+ai(f)+","+r+"]",n.oldStyle=f),o=n.type,o==="hover"||o==="active"){if(!n.hasBindEvent){var h=n.element,i=avalon(h),c="mouseenter",l="mouseleave";o==="active"&&(h.tabIndex=h.tabIndex||-1,c="mousedown",l="mouseup",a=i.bind("mouseleave",function(){n.toggleClass&&i.removeClass(n.newClass)}))}v=i.bind(c,function(){n.toggleClass&&i.addClass(n.newClass)});y=i.bind(l,function(){n.toggleClass&&i.removeClass(n.newClass)});n.rollback=function(){i.unbind("mouseleave",a);i.unbind(c,v);i.unbind(l,y)};n.hasBindEvent=!0}rt(n.expr,t,n)};a["class"]=function(n,t,i){var r=avalon(t);i.newClass=n[0];i.toggleClass=!!n[1];i.oldClass&&i.newClass!==i.oldClass&&r.removeClass(i.oldClass);i.oldClass=i.newClass;i.type==="class"&&(i.oldStyle?r.toggleClass(i.oldStyle,!!n[1]):r.toggleClass(i.newClass,i.toggleClass))};"hover,active".replace(e,function(n){r[n]=r["class"]});a.data=function(n,t,i){var r="data-"+i.param;n&&typeof n=="object"?t[r]=n:t.setAttribute(r,String(n))};st=r.duplex=function(n,t){var i=n.element,e,r,o,s,h,c,f;if(rt(n.value,t,n,1),n.changed=vt(i,"data-duplex-changed",t)||l,n.evaluator&&n.args){r=[];o=ut("string,number,boolean,checked");i.type==="radio"&&n.param===""&&(n.param="checked");i.msData&&(i.msData["ms-duplex"]=n.value);n.param.replace(/\w+/g,function(t){/^(checkbox|radio)$/.test(i.type)&&/^(radio|checked)$/.test(t)&&(t==="radio"&&u("ms-duplex-radio已经更名为ms-duplex-checked"),t="checked",n.isChecked=!0);t==="bool"?(t="boolean",u("ms-duplex-bool已经更名为ms-duplex-boolean")):t==="text"&&(t="string",u("ms-duplex-text已经更名为ms-duplex-string"));o[t]&&(e=!0);avalon.Array.ensure(r,t)});e||r.push("string");n.param=r.join("-");n.bound=function(t,r){i.addEventListener?i.addEventListener(t,r,!1):i.attachEvent("on"+t,r);var u=n.rollback;n.rollback=function(){i.avalonSetter=null;avalon.unbind(i,t,r);u&&u()}};for(s in avalon.vmodels)h=avalon.vmodels[s],h.$fire("avalon-ms-duplex-init",n);c=n.pipe||(n.pipe=dc);c(null,n,"init");f=i.tagName;st[f]&&st[f](i,n.evaluator.apply(null,n.args),n)}};avalon.duplexHooks={checked:{get:function(n,t){return!t.element.oldValue}},string:{get:function(n){return n},set:gr},boolean:{get:function(n){return n==="true"},set:gr},number:{get:function(n,t){var i=parseFloat(n),r;if(-n==-i)return i;r=/strong|medium|weak/.exec(t.element.getAttribute("data-duplex-number"))||["medium"];switch(r[0]){case"strong":return 0;case"medium":return n===""?"":0;case"weak":return n}},set:gr}};yt=[];avalon.tick=function(n){yt.push(n)===1&&(de=setInterval(gc,60))};nu=l,new function(){var u;try{var n={},t=HTMLInputElement.prototype,i=HTMLTextAreaElement.prototype;function r(t){n[this.tagName].call(this,t);!this.msFocus&&this.avalonSetter&&this.avalonSetter()}u=HTMLInputElement.prototype;Object.getOwnPropertyNames(u);n.INPUT=Object.getOwnPropertyDescriptor(t,"value").set;Object.defineProperty(t,"value",{set:r});n.TEXTAREA=Object.getOwnPropertyDescriptor(i,"value").set;Object.defineProperty(i,"value",{set:r})}catch(f){nu=avalon.tick}};b&&avalon.bind(i,"selectionchange",function(){var n=i.activeElement||{};!n.msFocus&&n.avalonSetter&&n.avalonSetter()});ge=/^(file|button|reset|submit|checkbox|radio|range)$/;st.INPUT=function(n,t,i){function s(n){i.changed.call(this,n,i)}function w(){a=!0}function k(){a=!1}var v=n.type,r=i.bound,l=avalon(n),a=!1,c,f=function(){var r=n.value,u;a||r===c||(u=i.pipe(r,i,"get"),l.data("duplexObserve")!==!1&&(c=r,t(u),s.call(n,u)))},y,p;if(i.handler=function(){var f=i.pipe(t(),i,"set"),u,r;if(f!==c){if(u=!1,n.msFocus)try{r=nl(n);r.start===r.end&&(r=r.start,u=!0)}catch(e){}n.value=c=f;u&&!n.readyOnly&&tl(n,r,r)}},i.isChecked||v==="radio")y=b===6,f=function(){if(l.data("duplexObserve")!==!1){var r=i.pipe(n.value,i,"get");t(r);s.call(n,r)}},i.handler=function(){var u=t(),r=i.isChecked?!!u:u+""===n.value;n.oldValue=r;y?setTimeout(function(){n.defaultChecked=r;n.checked=r},31):n.checked=r},r("click",f);else if(v==="checkbox")f=function(){var f,r,e;l.data("duplexObserve")!==!1&&(f=n.checked?"ensure":"remove",r=t(),Array.isArray(r)||(u("ms-duplex应用于checkbox上要对应一个数组"),r=[r]),e=i.pipe(n.value,i,"get"),avalon.Array[f](r,e),s.call(n,r))},i.handler=function(){var r=[].concat(t()),u=i.pipe(n.value,i,"get");n.checked=r.indexOf(u)>-1},r(o?"change":"click",f);else{p=n.getAttribute("data-duplex-event")||"input";n.attributes["data-event"]&&u("data-event指令已经废弃，请改用data-duplex-event");function d(n){setTimeout(function(){f(n)})}p.replace(e,function(n){switch(n){case"input":b?(b>8?(b===9&&r("keyup",f),r("input",f)):r("propertychange",function(n){n.propertyName==="value"&&f()}),r("dragend",d)):(r("input",f),r("compositionstart",w),r("compositionend",k),r("DOMAutoComplete",f));break;default:r(n,f)}});ge.test(n.type)||(n.type!=="hidden"&&(r("focus",function(){n.msFocus=!0}),r("blur",function(){n.msFocus=!1})),n.avalonSetter=f,nu(function(){if(h.contains(n))n.msFocus||f();else if(!n.msRetain)return!1}))}avalon.injectBinding(i);s.call(n,n.value)};st.TEXTAREA=st.INPUT;st.SELECT=function(n,t,i){function f(){if(r.data("duplexObserve")!==!1){var u=r.val();u=Array.isArray(u)?u.map(function(n){return i.pipe(n,i,"get")}):i.pipe(u,i,"get");u+""!==n.oldValue&&t(u);i.changed.call(n,u,i)}}var r=avalon(n);i.handler=function(){var i=t();i=i&&i.$model||i;Array.isArray(i)?n.multiple||u("ms-duplex在<select multiple=true>上要求对应一个数组"):n.multiple&&u("ms-duplex在<select multiple=false>不能对应一个数组");i=Array.isArray(i)?i.map(String):i+"";i+""!==n.oldValue&&(r.val(i),n.oldValue=i+"")};i.bound("change",f);n.msCallback=function(){avalon.injectBinding(i);i.changed.call(n,t(),i)}};a.html=function(n,t,r){var h=t.nodeType!==1,f=h?t.parentNode:t,s,u,e,c,o;if(f){if(n=n==null?"":n,r.oldText!==n)r.oldText=n;else return;if(t.nodeType===3&&(s=w("html"),f.insertBefore(i.createComment(s),t),r.element=i.createComment(s+":end"),f.replaceChild(r.element,t),t=r.element),typeof n!="object")u=avalon.parseHTML(String(n));else if(n.nodeType===11)u=n;else if(n.nodeType===1||n.item)for(e=n.nodeType===1?n.childNodes:n.item,u=ct.cloneNode(!0);e[0];)u.appendChild(e[0]);if(e=avalon.slice(u.childNodes),h){for(c=t.nodeValue.slice(0,-4);;)if(o=t.previousSibling,o&&(o.nodeType!==8||o.nodeValue!==c))f.removeChild(o);else break;f.insertBefore(u,t)}else avalon.clearHTML(t).appendChild(u);ni(e,r.vmodels)}};r["if"]=r.data=r.text=r.html=function(n,t){rt(n.value,t,n)};a["if"]=function(n,t,r){try{if(!t.parentNode)return}catch(f){return}if(n)t.nodeType===8&&(t.parentNode.replaceChild(r.template,t),t.ifRemove=null,t=r.element=r.template),t.getAttribute(r.name)&&(t.removeAttribute(r.name),oe(t,r.vmodels)),r.rollback=null;else if(t.nodeType===1){var u=r.element=i.createComment("ms-if");t.parentNode.replaceChild(u,t);t.ifRemove=u;r.template=t;d.appendChild(t);r.rollback=function(){t.parentNode===d&&d.removeChild(t)}}};tu=/\(([^)]*)\)/;r.on=function(n,t){var i=n.value,u,f;n.type="on";u=n.param.replace(/-\d+$/,"");typeof r.on[u+"Hook"]=="function"&&r.on[u+"Hook"](n);i.indexOf("(")>0&&i.indexOf(")")>-1&&(f=(i.match(tu)||["",""])[1].trim(),(f===""||f==="$event")&&(i=i.replace(tu,"")));rt(i,t,n)};a.on=function(n,t,i){var r,u;n=function(n){var t=i.evaluator||l;return t.apply(this,i.args.concat(n))};r=i.param.replace(/-\d+$/,"");r==="scan"?n.call(t,{type:r}):typeof i.specialBind=="function"?i.specialBind(t,n):u=avalon.bind(t,r,n);i.rollback=function(){typeof i.specialUnbind=="function"?i.specialUnbind():avalon.unbind(t,r,u)}};r.repeat=function(n,t){var y=n.type,o,f,e,s,b,h,u,c,tt,r,d,g,nt,ut,ft;rt(n.value,t,n,1);n.proxies=[];o=!1;try{f=n.$repeat=n.evaluator.apply(0,n.args||[]);e=avalon.type(f);e!=="object"&&e!=="array"?(o=!0,avalon.log("warning:"+n.value+"只能是对象或数组")):n.xtype=e}catch(et){o=!0}if(s=n.value.split(".")||[],s.length>1)for(s.pop(),b=s[0],h=0;u=t[h++];)if(u&&u.hasOwnProperty(b)){c=u[b].$events||{};c[p]=c[p]||[];ci(c[p],n);break}if(tt=n.handler,n.handler=l,avalon.injectBinding(n),n.handler=tt,r=n.element,r.nodeType===1){r.removeAttribute(n.name);n.sortedCallback=vt(r,"data-with-sorted",t);n.renderedCallback=vt(r,"data-"+y+"-rendered",t);var k=w(y),it=i.createComment(k),v=i.createComment(k+":end");if(n.signature=k,n.template=ct.cloneNode(!1),y==="repeat")d=r.parentNode,d.replaceChild(v,r),d.insertBefore(it,v),n.template.appendChild(r);else{while(r.firstChild)n.template.appendChild(r.firstChild);r.appendChild(it);r.appendChild(v)}n.element=v;n.handler=a.repeat;n.rollback=function(){var t=n.element;t&&n.handler("clear")}}if(!o){for(n.$outer={},g="$key",nt="$val",Array.isArray(f)&&(g="$first",nt="$last"),h=0;u=t[h++];)if(u.hasOwnProperty(g)&&u.hasOwnProperty(nt)){n.$outer=u;break}ut=f.$events;ft=(ut||{})[p];ci(ft,n);e==="object"?n.handler("append"):f.length&&n.handler("add",0,f.length)}};a.repeat=function(n,t,i){var r=this,k,y,ut,w,f,b,ft,ot,it,v,nt,u,tt,st,ht;if(!n&&r.xtype)if(k=r.$repeat,y=r.evaluator.apply(0,r.args||[]),r.xtype==="array"){if(k.length===y.length)if(k!==y&&k.length>0)a.repeat.call(this,"clear",t,i);else return;n="add";t=0;r.$repeat=y;i=y.length}else{if(uf(k).join(";;")===uf(y).join(";;"))return;n="append";r.$repeat=y}if(n){var h,e,c=r.element,d=il(r),o=c.parentNode,s=r.proxies,p=ct.cloneNode(!1);switch(n){case"add":for(ut=t+i,w=[],f=t;f<ut;f++)b=ol(f,r),s.splice(f,0,b),no(r,p,b,w);for(o.insertBefore(p,d[t]||c),f=0;e=w[f++];)ni(e.nodes,e.vmodels),e.nodes=e.vmodels=null;break;case"del":iu(d[t],d[t+i]||c);ft=s.splice(t,i);to(ft,"each");break;case"clear":h=d[0];h&&(iu(h,c),r.xtype==="object"?o.insertBefore(h,c):to(s,"each"));break;case"move":if(h=d[0],h){var lt=h.nodeValue,rt=[],g=[],et;for(iu(h,c,function(){g.unshift(this);this.nodeValue===lt&&(rt.unshift(g),g=[])}),sr(rt,t),sr(s,t);g=rt.shift();)while(et=g.shift())p.appendChild(et);o.insertBefore(p,c)}break;case"index":for(ot=s.length-1;i=s[t];t++)i.$index=t,i.$first=t===0,i.$last=t===ot;return;case"set":b=s[t];b&&hr(b.$events[r.param||"el"]);break;case"append":it=r.$repeat;v=Array.isArray(s)||!s?{}:s;r.proxies=v;nt=[];w=[];for(u in v)it.hasOwnProperty(u)||(io(v[u],ru),delete v[u]);for(u in it)it.hasOwnProperty(u)&&u!=="hasOwnProperty"&&nt.push(u);for(r.sortedCallback&&(tt=r.sortedCallback.call(o,nt),tt&&Array.isArray(tt)&&tt.length&&(nt=tt)),f=0;u=nt[f++];)u!=="hasOwnProperty"&&(v[u]=ul(v[u],u,r),no(r,p,v[u],w));for(o.insertBefore(p,c),f=0;e=w[f++];)ni(e.nodes,e.vmodels),e.nodes=e.vmodels=null}if(!r.$repeat||r.$repeat.hasOwnProperty("$lock"))return;n==="clear"&&(n="del");st=r.renderedCallback||l;ht=arguments;o.oldValue&&o.tagName==="SELECT"&&avalon(o).val(o.oldValue.split(","));st.apply(o,ht)}};"with,each".replace(e,function(n){r[n]=r.repeat});ru=[];ti=[];a.text=function(n,t){if(n=n==null?"":n,t.nodeType===3)try{t.data=n}catch(i){}else"textContent"in t?t.textContent=n:t.innerText=n};avalon.parseDisplay=ii;r.visible=function(n,t){rt(n.value,t,n)};a.visible=function(n,t,i){n?(t.style.display=i.display||"",avalon(t).css("display")==="none"&&(t.style.display=i.display=ii(t.nodeName))):t.style.display="none"};r.widget=function(t,i){var p=t.value.match(e),r=t.element,o=p[0],s=p[1],c,a,k,v,h,b,d,y,f;if(s&&s!=="$"||(s=w(o)),c=p[2]||o,a=avalon.ui[o],typeof a=="function"){for(i=r.vmodels||i,k=0;v=i[k++];)if(v.hasOwnProperty(c)&&typeof v[c]=="object"){h=v[c];h=h.$model||h;break}if(h&&(b=h[o+"Id"],typeof b=="string"&&(u("warning!不再支持"+o+"Id"),s=b)),d=avalon.getWidgetData(r,o),t.value=[o,s,c].join(","),t[o+"Id"]=s,t.evaluator=l,r.msData["ms-widget-id"]=s,y=t[o+"Options"]=avalon.mix({},a.defaults,h||{},d),r.removeAttribute("ms-widget"),f=a(r,t,i)||{},f.$id){avalon.vmodels[s]=f;ue(r,f);try{f.$init(function(){avalon.scan(r,[f].concat(i));typeof y.onInit=="function"&&y.onInit.call(r,f,y,i)})}catch(g){u(g)}t.rollback=function(){try{f.$remove();f.widgetElement=null}catch(n){}r.msData={};delete avalon.vmodels[f.$id]};hf(t,sl);n.chrome&&r.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(ar)})}else avalon.scan(r,i)}else i.length&&(r.vmodels=i)};var sl=[],hl=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,cl=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ll=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig,al={a:/\b(href)\=("javascript[^"]*"|'javascript[^']*')/ig,img:/\b(src)\=("javascript[^"]*"|'javascript[^']*')/ig,form:/\b(action)\=("javascript[^"]*"|'javascript[^']*')/ig},vl=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,yl=/([^\#-~| |!])/g;if(pi=avalon.filters={uppercase:function(n){return n.toUpperCase()},lowercase:function(n){return n.toLowerCase()},truncate:function(n,t,i){return t=t||30,i=typeof i=="string"?i:"...",n.length>t?n.slice(0,t-i.length)+i:String(n)},$filter:function(n){for(var i,r,f,t=1,u=arguments.length;t<u;t++)i=arguments[t],r=avalon.filters[i[0]],typeof r=="function"&&(f=[n].concat(i.slice(1)),n=r.apply(null,f));return n},camelize:li,sanitize:function(n){return n.replace(hl,"").replace(ll,function(n){var i=n.toLowerCase().match(/<(\w+)\s/),t;return i&&(t=al[i[1]],t&&(n=n.replace(t,function(n,t,i){var r=i.charAt(0);return t+"="+r+"javascript:void(0)"+r}))),n.replace(cl," ").replace(/\s+/g," ")})},escape:function(n){return String(n).replace(/&/g,"&amp;").replace(vl,function(n){var t=n.charCodeAt(0),i=n.charCodeAt(1);return"&#"+((t-55296)*1024+(i-56320)+65536)+";"}).replace(yl,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(n,t,i){return(t||"￥")+ro(n,isFinite(i)?i:2)},number:ro},new function(){function t(n){return parseInt(n,10)||0}function u(n,t,i){var r="";for(n<0&&(r="-",n=-n),n=""+n;n.length<t;)n="0"+n;return i&&(n=n.substr(n.length-t)),r+n}function n(n,t,i,r){return function(f){var e=f["get"+n]();return(i>0||e>-i)&&(e+=i),e===0&&i===-12&&(e=12),u(e,t,r)}}function i(n,t){return function(i,r){var u=i["get"+n](),f=(t?"SHORT"+n:n).toUpperCase();return r[f][u]}}function f(n){var t=-1*n.getTimezoneOffset(),i=t>=0?"+":"";return i+(u(Math[t>0?"floor":"ceil"](t/60),2)+u(Math.abs(t%60),2))}function e(n,t){return n.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}var o={yyyy:n("FullYear",4),yy:n("FullYear",2,0,!0),y:n("FullYear",1),MMMM:i("Month"),MMM:i("Month",!0),MM:n("Month",2,1),M:n("Month",1,1),dd:n("Date",2),d:n("Date",1),HH:n("Hours",2),H:n("Hours",1),hh:n("Hours",2,-12),h:n("Hours",1,-12),mm:n("Minutes",2),m:n("Minutes",1),ss:n("Seconds",2),s:n("Seconds",1),sss:n("Milliseconds",3),EEEE:i("Day"),EEE:i("Day",!0),a:e,Z:f},s=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,h=/^\/Date\((\d+)\)\/$/,r;pi.date=function(n,i){var w=pi.date.locate,b="",e=[],c,l,a,v,y,p;if(i=i||"mediumDate",i=w[i]||i,typeof n=="string")if(/^\d+$/.test(n))n=t(n);else if(h.test(n))n=+RegExp.$1;else{var f=n.trim(),r=[0,0,0,0,0,0,0],u=new Date(0);f=f.replace(/^(\d+)\D(\d+)\D(\d+)/,function(n,i,u,f){var e=f.length===4?[f,i,u]:[i,u,f];return r[0]=t(e[0]),r[1]=t(e[1])-1,r[2]=t(e[2]),""});a=u.setFullYear;v=u.setHours;f=f.replace(/[T\s](\d+):(\d+):?(\d+)?\.?(\d)?/,function(n,i,u,f,e){return r[3]=t(i),r[4]=t(u),r[5]=t(f),e&&(r[6]=Math.round(parseFloat("0."+e)*1e3)),""});y=0;p=0;f=f.replace(/Z|([+-])(\d\d):?(\d\d)/,function(n,i,r,f){return a=u.setUTCFullYear,v=u.setUTCHours,i&&(y=t(i+r),p=t(i+f)),""});r[3]-=y;r[4]-=p;a.apply(u,r.slice(0,3));v.apply(u,r.slice(3));n=u}if(typeof n=="number"&&(n=new Date(n)),avalon.type(n)==="date"){while(i)l=s.exec(i),l?(e=e.concat(l.slice(1)),i=e.pop()):(e.push(i),i=null);return e.forEach(function(t){c=o[t];b+=c?c(n,w):t.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),b}};r={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{"0":"周日","1":"周一","2":"周二","3":"周三","4":"周四","5":"周五","6":"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d H:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"H:mm:ss",short:"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};r.SHORTMONTH=r.MONTH;pi.date.locate=r},uu=[],pt=function(n){uo=!0;var t=avalon.require;for(t&&t.checkDeps&&(modules["domReady!"].state=4,t.checkDeps());n=uu.shift();)n(avalon)},i.readyState==="complete")setTimeout(pt);else if(o)i.addEventListener("DOMContentLoaded",pt);else{i.attachEvent("onreadystatechange",function(){i.readyState==="complete"&&pt()});try{eo=n.frameElement===null}catch(pl){}h.doScroll&&eo&&n.external&&fo()}return avalon.bind(n,"load",pt),avalon.ready=function(n){uo?n(avalon):uu.push(n)},avalon.config({loader:!0}),avalon.ready(function(){avalon.scan(i.body)}),typeof define=="function"&&define.amd&&define("avalon",[],function(){return avalon}),oo=n.avalon,avalon.noConflict=function(t){return t&&n.avalon===avalon&&(n.avalon=oo),avalon},t===void 0&&(n.avalon=avalon),avalon});
