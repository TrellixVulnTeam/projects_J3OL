function changeLossFee(){var n=$("#amount").val(),t;/^\+?[1-9][0-9]*$/.test(n)?parseInt(n)%100!=0?$("#spDown").html(""):(t=parseInt($("#spSL").html())-parseInt(n),$("#spDown").html(t)):$("#spDown").html("")}function numberFormat(n){if(n!=null)return n.toFixed(0).replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,")}function GetRounding(n,t){var i=Math.pow(10,t);return Math.round(n*i)/i}function FormatIntToCN(n){switch(n){case 1:return"一";case 2:return"二";case 3:return"三";case 4:return"四";case 5:return"五"}}requirejs.config({baseUrl:"js/lib",urlArgs:"v=20160801",waitSeconds:0,paths:{avalon:"avalon/avalon.min",mmHistory:"avalon/mmHistory.min",mmRouter:"avalon/mmRouter.min",jquery:"jquery/jquery.min",unslider:"unslider/js/unslider-min",md5:"jquery.MD5/jquery.md5.min",lodash:"lodash/lodash.min",Raphael:"raphael/raphael.min",dialog:"ui/dialog.min",text:"utils/text.min",tips:"ui/tips.min",cookies:"utils/cookies.min",numbers:"utils/numbers.min",dom:"utils/dom.min",settle:"trade/settle.min",dates:"utils/dates.min",validator:"utils/validate.min",account:"account/account.min",fund:"account/fund.min",trade:"trade/trade.min",stockPrice:"trade/stockPrice.min",stockSearch:"trade/stockSearch.min",queryString:"utils/queryString.min"},shim:{mmHistory:{deps:["avalon"]},mmRouter:{deps:["avalon"]},unslider:{deps:["jquery"]},md5:{deps:["jquery"]},Raphael:{exports:"Raphael"},fund:{deps:["jquery","avalon"],exports:"vmFund"},stockSearch:{exports:"vmStockSearch"},queryString:{deps:["jquery"]}}});require(["jquery","avalon","stockPrice","stockSearch","numbers","settle","cookies","text","dialog","validator","queryString","tips"],function(n,t,r,u,f,e,o,s,h,c,l){var a,v,y;n(".main-nav li").removeClass("curr");n("#nav-trade").toggleClass("curr");var nt="",b,k,d,p=o.getCookie("searchhistorylist"),tt=o.getCookie("IsShowRiskTip"),it=o.getCookie("IsShowRiskTip2"),rt=parseInt(l.GetValue("idx")!=undefined?l.GetValue("idx"):1),w="601988",g="601988.XSHG";p&&(p=JSON.parse(p),w.length>0&&(w=p[0].ticker,g=g+"."+p[0].exchange));a=t.define({$id:"vmPos",pageNumber:0,pageSize:200,totalRows:0,accountBalance:0,packetMoney:0,deferFeeTotal:"",totalPages:{get:function(){return Math.ceil(this.totalRows/this.pageSize)}},rows:[],load:function(t){(t=="undefined"||t==undefined)&&(t="");n.ajax({url:"ashx/AccountHandler.ashx?action=getStockPosition",type:"POST",data:{k:t,Ticker:w,pageNumber:a.pageNumber,pageSize:a.pageSize},success:function(n){vmTrade.accountNumber=n.accountNumber;vmTrade.accountBalance=n.balance;vmTrade.deferFeeTotal=n.deferFee;vmTrade.restContracts=n.restContracts;vmTrade.syncType=n.syncType;vmTrade.packetMoney=n.packetMoney;a.totalRows=n.total;a.rows=n.rows;t||(a.deferFeeTotal=n.deferFee,a.accountBalance=n.balance,a.packetMoney=n.packetMoney)}})},prev:function(){a.pageNumber=Math.max(0,a.pageNumber-1)},next:function(){a.pageNumber=Math.min(a.totalPages-1,a.pageNumber+1)},setPage:function(n){a.pageNumber=n}});a.$watch("pageNumber",a.load);v=t.define({$id:"vmRestingOrder",pageNumber:0,pageSize:20,totalRows:0,totalPages:{get:function(){return Math.ceil(this.totalRows/this.pageSize)}},rows:[],load:function(){n.ajax({url:"ashx/AccountHandler.ashx?action=getRestingOrder",type:"POST",data:{pageNumber:v.pageNumber,pageSize:v.pageSize},success:function(n){v.totalRows=n.total;v.rows=n.rows;a.accountBalance=n.balance}})},cancelOrder:function(t){var r=h,i=new s;t.direction==1?(i._('<h4 class="font24 txt-c">触发买入撤单<i><\/h4>'),i._('<div class="delegation-sure mt20">'),i._('<table border="0" cellpadding="0" cellspacing="0">'),i._('<tr class="on"><td><label>账户：<\/label><span>'+vmTrade.accountNumber+"<\/span><\/td><\/tr>"),i._("<tr><td><label>名称：<\/label><span>"+t.stockName+"<\/span><\/td><\/tr>"),i._("<tr><td><label>代码：<\/label><span>"+t.ticker+"<\/span><\/td><\/tr>"),i._("<tr><td><label>倍数：<\/label><span>"+(vmTrade.curPV/vmTrade.curPB).toFixed(0)+"倍<\/span><\/td><\/tr>"),i._("<tr><td><label>数量：<\/label><span>"+t.quantity+"股<\/span><\/td><\/tr>"),i._('<tr class="on"><td><label>委托买入时间：<\/label><span>'+new Date(t.confirmedTime).Format("yyyy-MM-dd HH:mm:ss")+"<\/span><\/td><\/tr>"),i._("<tr><td><label>买入金额：<\/label><span>"+t.principalValue+"元<\/span><\/td>"),i._("<td><label>委托价格：<\/label><span>"+t.restingPrice.toFixed(2)+"元<\/span><\/td><\/tr>"),i._("<tr><td><label>止损金额：<\/label><span>"+t.stopLoss.toFixed(0)+"元<\/span><\/td>"),i._("<td><label>保证金额：<\/label><span>"+t.performanceBond.toFixed(0)+"元<\/span><\/td><\/tr>"),i._("<\/table><\/div>"),i._('<div class="btn-group txt-c clear mt30">'),i._('<button class="btn btn-ok btn1" id="resting-submitCancelBuy" type="button" dialog-btn-notify="#di#,1">确认<\/button>'),i._('<button class="btn btn-delete btn2" id="resting-buyCancel" type="button" dialog-btn-notify="#di#,2">取消<\/button>'),i._("<\/div>")):(i._('<h4 class="font24 txt-c">触发卖出撤单<i><\/h4>'),i._('<div class="delegation-sure mt20">'),i._('<table border="0" cellpadding="0" cellspacing="0">'),i._('<tr class="on"><td><label>账户：<\/label><span>'+vmTrade.accountNumber+"<\/span><\/td><\/tr>"),i._("<tr><td><label>名称：<\/label><span>"+t.stockName+"<\/span><\/td><\/tr>"),i._("<tr><td><label>代码：<\/label><span>"+t.ticker+"<\/span><\/td><\/tr>"),i._("<tr><td><label>倍数：<\/label><span>"+(t.principalValue/(t.performanceBond-t.additionalFee)).toFixed(0)+"倍<\/span><\/td><\/tr>"),i._('<tr class="on"><td><label>数量：<\/label><span>'+t.quantity+"股<\/span><\/td><\/tr>"),i._("<tr><td><label>委托时间：<\/label><span>"+new Date(t.confirmedTime).Format("yyyy-MM-dd HH:mm:ss")+"<\/span><\/td><\/tr>"),i._("<tr><td><label>买入时间：<\/label><span>"+new Date(t.buyTime).Format("yyyy-MM-dd HH:mm:ss")+"<\/span><\/td><\/tr>"),i._('<tr class="on"><td><label>持仓时间：<\/label><span>'+t.positionDays+"天<\/span><\/td><\/tr>"),i._("<tr><td><label>买入金额：<\/label><span>"+t.principalValue+"元<\/span><\/td>"),i._("<td><label>买入价格：<\/label><span>"+t.buyPrice.toFixed(2)+"元<\/span><\/td><\/tr>"),i._("<tr><td><label>止损金额：<\/label><span>"+t.stopLoss.toFixed(0)+"元<\/span><\/td>"),i._("<td><label>保证金额：<\/label><span>"+t.performanceBond.toFixed(0)+"元<\/span><\/td><\/tr>"),i._('<tr><td class="'+(t.restingPrice>t.buyPrice?"red":t.restingPrice<t.buyPrice?"blue":"black")+' bold"><label>委托价格：<\/label><span>'+t.restingPrice.toFixed(2)+"元<\/span><\/td>"),i._('<td class="'+(t.restingPrice>t.buyPrice?"red":t.restingPrice<t.buyPrice?"blue":"black")+' bold"><label>参考盈亏：<\/label><span>'+((t.restingPrice-t.buyPrice)*t.quantity).toFixed(0)+"元<\/span><\/td><\/tr>"),i._("<\/table><\/div>"),i._('<div class="btn-group txt-c clear mt30">'),i._('<button class="btn btn-ok btn1" id="resting-submitCancelBuy" type="button" dialog-btn-notify="#di#,1">确认<\/button>'),i._('<button class="btn btn-delete btn2" id="resting-buyCancel" type="button" dialog-btn-notify="#di#,2">取消<\/button>'),i._("<\/div>"));r.open(i.ts(),{width:550,notify:function(i){(n("#resting-submitCancelBuy").blur(),n("#resting-buyCancel").blur(),i!=0)&&(i==1&&n.ajax({url:"ashx/TradeHandler.ashx?action=cancelOrder",type:"POST",data:{orderID:t.id},success:function(n){return n.code===1?h.alert("撤销成功",2,{title:"温馨提示",width:420,notify:function(){v.load()}}):h.alert("撤销失败："+n.msg,1,{title:"温馨提示",width:420,notify:function(){v.load()}}),!1}}),h.close())}})},prev:function(){v.pageNumber=Math.max(0,v.pageNumber-1)},next:function(){v.pageNumber=Math.min(v.totalPages-1,v.pageNumber+1)},setPage:function(n){v.pageNumber=n}});v.$watch("pageNumber",v.load);y=t.define({$id:"vmSettlement",pageNumber:0,pageSize:10,totalRows:0,totalPages:{get:function(){return Math.ceil(this.totalRows/this.pageSize)}},rows:[],load:function(){n.ajax({url:"ashx/AccountHandler.ashx?action=getSettlement",type:"POST",data:{pageNumber:y.pageNumber,pageSize:y.pageSize},success:function(n){y.totalRows=n.total;y.rows=n.rows}})},prev:function(){y.pageNumber=Math.max(0,y.pageNumber-1)},next:function(){y.pageNumber=Math.min(y.totalPages-1,y.pageNumber+1)},setPage:function(n){y.pageNumber=n}});y.$watch("pageNumber",y.load);vmTrade=t.define({$id:"vmTrade",activeTab:1,activeChart:0,isBusy:!1,searchVisible:!1,inititalized:!1,restingPrice:0,category:1,initPrice:0,initQuantity:0,tradeTimeRange:"09:30,11:30|13:00,14:55",currTicker:w,currSecID:g,curStockPrice:r,serverTime:new Date,isOpenTime:!1,isTradeTime:!1,isTradeDate:!1,tradeDisabled:{get:function(){return this.isBusy||!this.isTradeTime||this.curStockPrice.stockRisk.length>0}},tradePrompt:{get:function(){return this.isBusy?"处理中...":this.isTradeTime?this.curStockPrice.stockRisk.length===0?"立即买入":"高风险禁止交易":"非交易时段"}},btnBuyText:"稍等。。。",curPB:{get:function(){return Math.round(this.curPV/this.curLeverage,0)}},curSLPrice:{get:function(){return Math.round(this.curPV*.02-this.curPB,0)}},serviceFeeRate:5,deferFeeRate:15,maxPriceChange:.08,syncRate:.05,asyncRate:.05,stockPrice:{get:function(){var r=this.curStockPrice.lastPrice,n,t,i;return this.category==2&&(r=vmTrade.restingPrice),n=GetRounding(this.curStockPrice.prevClosePrice*1.1,2).toFixed(2),t=0,t=this.syncType==2?GetRounding(r*(1+this.syncRate),2).toFixed(2):GetRounding(r*(1+this.asyncRate),2).toFixed(2),i=0,i=this.syncType==2?GetRounding(this.curStockPrice.lastPrice*(1+this.syncRate),2).toFixed(2):GetRounding(this.curStockPrice.lastPrice*(1+this.asyncRate),2).toFixed(2),this.initPrice=parseFloat(n)<parseFloat(i)?n:i,parseFloat(n)<parseFloat(t)?n:t}},serviceFee:{get:function(){return this.curPV/1e3*this.serviceFeeRate}},deferFee:{get:function(){return this.curPV/1e3*this.deferFeeRate}},maxShare:{get:function(){return this.initQuantity=Math.floor(this.curPV/this.initPrice/100)*100,Math.floor(this.curPV/this.stockPrice/100)*100}},maxAmount:{get:function(){return this.category==1?this.maxShare*this.curStockPrice.lastPrice:this.category==2?this.maxShare*vmTrade.restingPrice:void 0}},maxFundRate:{get:function(){return this.maxAmount/this.curPV*100}},setPrice:function(){var t=parseFloat(n("#buyRestingPrice").val().trim()).toFixed(2);c.isNumber(t)||(t=vmTrade.curStockPrice.lastPrice);n("#buyRestingPrice").val(t);vmTrade.restingPrice=t;parseFloat(t)>=parseFloat((vmTrade.curStockPrice.prevClosePrice*1.08).toFixed(2))&&(vmTrade.restingPrice=(vmTrade.curStockPrice.prevClosePrice*1.08).toFixed(2),n("#buyRestingPrice").val(vmTrade.restingPrice));parseFloat(t)<=parseFloat((vmTrade.curStockPrice.prevClosePrice*.92).toFixed(2))&&(vmTrade.restingPrice=(vmTrade.curStockPrice.prevClosePrice*.92).toFixed(2),n("#buyRestingPrice").val(vmTrade.restingPrice));vmTrade.stockPrice;vmTrade.maxShare;vmTrade.maxAmount;vmTrade.maxFundRate},addPrice:function(){var i=n("#buyRestingPrice").val(),t;c.isNumber(i)||(i=vmTrade.curStockPrice.lastPrice);t=(parseFloat(i)+.01).toFixed(2);parseFloat(t)<=parseFloat((vmTrade.curStockPrice.prevClosePrice*1.08).toFixed(2))&&(vmTrade.restingPrice=t,n("#buyRestingPrice").val(t),vmTrade.stockPrice,vmTrade.maxShare,vmTrade.maxAmount,vmTrade.maxFundRate)},subPrice:function(){var i=n("#buyRestingPrice").val(),t;c.isNumber(i)||(i=vmTrade.curStockPrice.lastPrice);t=(parseFloat(i)-.01).toFixed(2);parseFloat(t)>=parseFloat((vmTrade.curStockPrice.prevClosePrice*.92).toFixed(2))&&(vmTrade.restingPrice=t,n("#buyRestingPrice").val(t),vmTrade.stockPrice,vmTrade.maxShare,vmTrade.maxAmount,vmTrade.maxFundRate)},selectCategory:function(n){vmTrade.category=n},accountBalance:0,packetMoney:0,deferFeeTotal:0,accountNumber:"",restContracts:0,syncType:1,selectStopLoss:function(n){u.currSoptLoss=n},selectTab:function(n){vmTrade.activeTab=n;n===1&&a.load();n===2&&a.load();n===3&&y.load();n===4&&v.load()},toggleChart:function(n){vmTrade.activeChart=n;n===0?_GlobalVar.IsK=!1:n===1&&(_GlobalVar.IsK=!0);_GetStockInfo()},showSearch:function(){event.stopPropagation();u.qryKeyword="";var n=o.getCookie("searchhistorylist");u.queryResult=n?JSON.parse(n):[];u.searchVisible=!0},hideSearch:function(){event.stopPropagation();u.searchVisible=!1},getPrice:function(){u.getPrice(vmTrade.curStockPrice.ticker,function(n){if(nt=vmTrade.curStockPrice.securityID,b=new Date,n.code===1){var i=n.data;t.mix(vmTrade.curStockPrice,i);console.log(i);vmTrade.curStockPrice.stockRisk=i.shortNM?i.shortNM.indexOf("S")>=0?"ST高风险":i.isRiskStock?"高风险":i.suspension==1?"停牌":"":"暂无报价";vmTrade.curStockPrice.format();u.inititalized=!0;vmTrade.btnBuyText=vmTrade.isTradeTime?vmTrade.curStockPrice.stockRisk.length===0?"立即买入":"高风险禁止交易":"非交易时段";vmTrade.curStockPrice.amplitude=GetRounding(vmTrade.curStockPrice.amplitude,2).toFixed(2)}else vmTrade.curStockPrice.stockRisk="行情读取失败",vmTrade.curStockPrice&&vmTrade.curStockPrice.clear(),setTimeout(vmTrade.getPrice,1e3);_GlobalVar.Stock.ExchangeCode=vmTrade.curStockPrice.exchangeCD;_GlobalVar.Stock.Ticker=vmTrade.curStockPrice.ticker;_GlobalVar.Stock.ClosePrice=vmTrade.curStockPrice.prevClosePrice;_GetStockInfo()})},showSettlement:function(n){event.preventDefault();console.log(n);e.showDialog(n.$model)},getServerTime:function(){n.ajax({url:"ashx/TradeHandler.ashx?action=getServerTime",type:"POST",success:function(n){n.code===1&&n.data&&(vmTrade.serverTime=n.data.serverTime,vmTrade.isTradeTime=n.data.isTradeTime,vmTrade.isOpenTime=n.data.isOpenTime,vmTrade.isTradeDate=n.data.isTradeDate)},error:function(n,t){console.log(t);setTimeout(vmTrade.getServerTime,1e3)}})},selectTicker:function(n){var t,r,f,u,i;if(vmTrade.hideSearch(),vmTrade.curStockPrice.securityID=n.ticker+"."+n.exchange,vmTrade.curStockPrice.ticker=n.ticker,w=n.ticker,t=o.getCookie("searchhistorylist"),r=[],r.push({ticker:n.ticker,cnSpell:n.cnSpell,exchange:n.exchange,shortName:n.shortName,highRisk:n.highRisk}),t)for(t=JSON.parse(t),f=t.length,u=0,i=0;i<f;i++)if(n.ticker!==t[i].ticker&&(u++,r.push(t[i])),u===9)break;o.setCookie("searchhistorylist",JSON.stringify(r));vmTrade.getPrice()},restingBuy:function(t){var r,u,i;if(n(this).blur(),t=t||window.event,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,vmTrade.isBusy)return!1;if(!vmTrade.isTradeTime)return h.alert("非交易时间，不允许操作，请稍后再试",0,{title:"温馨提示",width:420}),!1;if(vmTrade.curStockPrice.stockRisk.length)return h.alert("高风险，暂时不能交易",0,{title:"温馨提示",width:420}),!1;if(r=n("#agree").is(":checked"),!r)return h.alert('<span>请阅读并同意以下协议:<\/span><a href="zfbz.html" target="_blank" class="txt-s12">《策略人参与沪深A股交易合作涉及费用及资费标准》<\/a><br><a href="hzxy.html" target="_blank" class="txt-s12">《上上策投资人与策略人参与沪深A股交易合作协议》<\/a><br><a href="fwxy.html" target="_blank" class="txt-s12">《上上策服务协议》<\/a>',0,{title:"温馨提示",width:500}),!1;tt?vmTrade.restingBuy2(t):(u=h,i=new s,i._('<h4 class="font24 red txt-c">风险提示<\/h4>'),i._('<div class="risk-warning">当实盘成交价出现该触发价时，<b class="bold red">投资人会以该触发时间发起市价买入，最终成交的价格以实际成交价格为准<\/b>，而非以设置的触发价为准，如有疑问可申请交割单，该功能与券商委托挂单有很大的区别，请谨慎使用！如阅毕并确认无误，点击确认按钮，此次触发买入生效。<\/div>'),i._('<div class="checkbox checkbox2">'),i._('<input type="checkbox" id="ckTip" name="checkboox[]">'),i._('<label for="ckTip">以后不再提醒<\/label><\/div>'),i._('<div class="txt-c mt20"><input id="comit-tip" class="btn btn-sure sure" type="button" dialog-btn-notify="#di#,1" value="确 认"><\/div>'),u.open(i.ts(),{width:550,notify:function(i){if(n("#comit-tip").blur(),i!=0){var r=n("#ckTip").is(":checked");r&&(o.setCookie("IsShowRiskTip",!1),tt=!0);h.close();vmTrade.restingBuy2(t)}}}))},restingBuy2:function(){var r=!0,u=h,t=new s;for(t._('<h4 class="font24 txt-c">触发买入<\/h4>'),t._('<div class="clear mt30">'),t._('<div class="delegation-left fl txt-c">'),t._('<input type="text" placeholder="'+vmTrade.curStockPrice.shortNM+'" class="agu" disabled style="cursor:default">'),t._('<p><input id="restingLastPrice" type="text" placeholder="'+vmTrade.curStockPrice.lastPrice.toFixed(2)+'" class="agu" disabled  style="cursor:default"><\/p>'),t._('<p class="clear money-input"><i class="fl" onclick="vmTrade.subPrice()"><img src="images/minus.png"><\/i><input id="buyRestingPrice" onchange="vmTrade.setPrice()" type="text" value="'+vmTrade.curStockPrice.lastPrice.toFixed(2)+'"><i class="fr" onclick="vmTrade.addPrice()"><img src="images/plus.png"><\/i><\/p>'),t._('<input id="comit-price" type="button" class="btn btn-delega" dialog-btn-notify="#di#,1" value="确 认">'),t._('<p class="clear mt20 pl-pr10"><span class="fl red">涨停'+vmTrade.curStockPrice.surgedLimit.toFixed(2)+'<\/span><span class="fr blue">跌停'+vmTrade.curStockPrice.declineLimit.toFixed(2)+"<\/span><\/p>"),t._("<\/div>"),t._('<div id="dialogDivPrice" class="delegation-right fr">'),t._('<table border="0" cellpadding="0" cellspacing="0">'),t._('<colgroup><col style="width:40px;"><col style="width:55px;"><col style="width:75px;"><\/colgroup>'),i=0;i<vmTrade.curStockPrice.askBook.length;i++)t._("<tr><td>卖"+vmTrade.curStockPrice.askBookIdx[i]+'<\/td><td class="txt-r">'+vmTrade.curStockPrice.askBook[i].price.toFixed(2)+'<\/td><td class="txt-r">'+numberFormat(vmTrade.curStockPrice.askBook[i].volume)+"<\/td><\/tr>");for(t._("<\/table>"),t._('<table border="0" cellpadding="0" cellspacing="0" class="mt30">'),t._('<colgroup><col style="width:40px;"><col style="width:55px;"><col style="width:75px;"><\/colgroup>'),i=0;i<vmTrade.curStockPrice.bidBook.length;i++)t._("<tr><td>买"+vmTrade.curStockPrice.bidBookIdx[i]+'<\/td><td class="txt-r">'+vmTrade.curStockPrice.bidBook[i].price.toFixed(2)+'<\/td><td class="txt-r">'+numberFormat(vmTrade.curStockPrice.bidBook[i].volume)+"<\/td><\/tr>");t._("<\/table>");t._("<\/div>");t._("<\/div>");u.open(t.ts(),{width:550,notify:function(t){if(n("#comit-price").blur(),t==0){r&&(vmTrade.selectCategory(1),clearInterval(k));return}r=!1;clearInterval(k);h.close();vmTrade.restingBuy3()}});vmTrade.restingPrice=vmTrade.curStockPrice.lastPrice.toFixed(2);vmTrade.selectCategory(2);k=setInterval("vmTrade.loadDialogPrice()",1e3)},restingBuy3:function(){var i=h,t=new s;t._('<h4 class="font24 txt-c">触发买入确认<\/h4>');t._('<div class="delegation-sure mt20">');t._('<table border="0" cellpadding="0" cellspacing="0">');t._('<tr class="on"><td><label>账户：<\/label><span>'+vmTrade.accountNumber+"<\/span><\/td><\/tr>");t._("<tr><td><label>名称：<\/label><span>"+vmTrade.curStockPrice.shortNM+"<\/span><\/td><\/tr>");t._("<tr><td><label>代码：<\/label><span>"+vmTrade.curStockPrice.ticker+"<\/span><\/td><\/tr>");t._("<tr><td><label>倍数：<\/label><span>"+(vmTrade.curPV/vmTrade.curPB).toFixed(0)+"倍<\/span><\/td><\/tr>");t._("<tr><td><label>数量：<\/label><span>"+vmTrade.maxShare+"股<\/span><\/td><\/tr>");t._('<tr class="on"><td><label>委托时间：<\/label><span>'+(new Date).Format("yyyy-MM-dd HH:mm:ss")+"<\/span><\/td><\/tr>");t._("<tr><td><label>买入金额：<\/label><span>"+vmTrade.curPV+"<\/span><\/td><\/tr>");t._("<tr><td><label>委托价格：<\/label><span>"+vmTrade.restingPrice+"<\/span><\/td><\/tr>");t._("<tr><td><label>止损金额：<\/label><span>"+vmTrade.curSLPrice+"元<\/span><\/td><\/tr>");t._("<tr><td><label>保证金额：<\/label><span>"+vmTrade.curPB+"元<\/span><\/td><\/tr>");t._("<\/table><\/div>");t._('<div class="red tips-pop">风险提示：我们将接受您的请求，将在'+vmTrade.restingPrice+"元的价位发起此次股票的点买策略，最终买入价格以实际成交价格为准，股市行情变化快速，当您资金量较大时，请谨慎使用此功能，以避免不需要的损失！>>><\/div>");t._('<div class="btn-group txt-c clear">');t._('<button class="btn btn-ok btn1" id="comit-restingSubmitBuy" type="button" dialog-btn-notify="#di#,1">确认<\/button>');t._('<button class="btn btn-delete btn2" id="comit-restingBuyCancel" type="button" dialog-btn-notify="#di#,2">取消<\/button>');t._("<\/div>");i.open(t.ts(),{width:550,notify:function(t){if(n("#comit-restingSubmitBuy").blur(),n("#comit-restingBuyCancel").blur(),t==0){vmTrade.selectCategory(1);return}return t==1&&(vmTrade.isBusy=!0,n.ajax({url:"ashx/TradeHandler.ashx?action=submitBuy",type:"POST",data:{ticker:vmTrade.curStockPrice.ticker,pv:vmTrade.curPV,pb:vmTrade.curPB,sp:vmTrade.curPV/1e4*vmTrade.curSP,sl:vmTrade.curSLPrice,buyQuantity:vmTrade.maxShare,buyPrice:vmTrade.stockPrice,restingPrice:vmTrade.restingPrice,initPrice:vmTrade.initPrice,initQuantity:vmTrade.initQuantity,category:vmTrade.category},success:function(n){if(vmTrade.isBusy=!1,n.code===1)vmTrade.category==1?(vmTrade.selectTab(2),h.close(),h.alert("买入"+vmTrade.curStockPrice.shortNM+"委托成功",2,{title:"温馨提示",width:420})):vmTrade.category==2&&(vmTrade.selectTab(4),h.close(),h.alert("触发买入"+vmTrade.curStockPrice.shortNM+"成功",2,{title:"温馨提示",width:420}));else return h.alert("买入"+vmTrade.curStockPrice.shortNM+"委托失败："+n.msg,1,{title:"温馨提示",width:420}),!1;return!1},error:function(n,t){console.log(t);vmTrade.isBusy=!1}})),t==2?(h.close(),!1):void 0}})},loadDialogPrice:function(){var t=new s;for(t._('<table border="0" cellpadding="0" cellspacing="0">'),t._('<colgroup><col style="width:40px;"><col style="width:55px;"><col style="width:75px;"><\/colgroup>'),i=0;i<vmTrade.curStockPrice.askBook.length;i++)t._("<tr><td>卖"+vmTrade.curStockPrice.askBookIdx[i]+'<\/td><td class="txt-r">'+vmTrade.curStockPrice.askBook[i].price.toFixed(2)+'<\/td><td class="txt-r">'+numberFormat(vmTrade.curStockPrice.askBook[i].volume)+"<\/td><\/tr>");for(t._("<\/table>"),t._('<table border="0" cellpadding="0" cellspacing="0"  class="mt30">'),t._('<colgroup><col style="width:40px;"><col style="width:55px;"><col style="width:75px;"><\/colgroup>'),i=0;i<vmTrade.curStockPrice.bidBook.length;i++)t._("<tr><td>买"+vmTrade.curStockPrice.bidBookIdx[i]+'<\/td><td class="txt-r">'+vmTrade.curStockPrice.bidBook[i].price.toFixed(2)+'<\/td><td class="txt-r">'+numberFormat(vmTrade.curStockPrice.bidBook[i].volume)+"<\/td><\/tr>");t._("<\/table>");n("#dialogDivPrice").html(t.ts());n("#restingLastPrice").val(vmTrade.curStockPrice.lastPrice.toFixed(2))},submitBuy:function(t){var r,u,i;return(n(this).blur(),t=t||window.event,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,vmTrade.isBusy)?!1:vmTrade.isTradeTime?vmTrade.curStockPrice.stockRisk.length?(h.alert("高风险，暂时不能交易",0,{title:"温馨提示",width:420}),!1):(r=n("#agree").is(":checked"),!r)?(h.alert('请阅读并同意以下协议:<br><br><a href="zfbz.html" target="_blank" class="txt-s12">《策略人参与沪深A股交易合作涉及费用及资费标准》<\/a><br><a href="hzxy.html" target="_blank" class="txt-s12">《上上策投资人与策略人参与沪深A股交易合作协议》<\/a><br><a href="fwxy.html" target="_blank" class="txt-s12">《上上策服务协议》<\/a>',0,{title:"温馨提示",width:500}),!1):(u=h,i=new s,i._('<h4 class="font24 txt-c">买入确认<\/h4>'),i._('<div class="delegation-sure mt20">'),i._('<table border="0" cellpadding="0" cellspacing="0">'),i._('<tr class="on"><td><label>账户：<\/label><span>'+vmTrade.accountNumber+"<\/span><\/td><\/tr>"),i._("<tr><td><label>名称：<\/label><span>"+vmTrade.curStockPrice.shortNM+"<\/span><\/td><\/tr>"),i._("<tr><td><label>代码：<\/label><span>"+vmTrade.curStockPrice.ticker+"<\/span><\/td><\/tr>"),i._("<tr><td><label>倍数：<\/label><span>"+(vmTrade.curPV/vmTrade.curPB).toFixed(0)+"倍<\/span><\/td><\/tr>"),i._('<tr class="on"><td><label>数量：<\/label><span>'+vmTrade.maxShare+"股<\/span><\/td><\/tr>"),i._('<tr class="on"><td><label>发布时间：<\/label><span>'+(new Date).Format("yyyy-MM-dd HH:mm:ss")+"<\/span><\/td><\/tr>"),i._("<tr><td><label>买入金额：<\/label><span>"+vmTrade.curPV+"<\/span><\/td>"),i._("<td><label>点买价格：<\/label><span>"+vmTrade.curStockPrice.lastPrice+"<\/span><\/td><\/tr>"),i._("<tr><td><label>止损金额：<\/label><span>"+vmTrade.curSLPrice+"元<\/span><\/td>"),i._("<td><label>保证金额：<\/label><span>"+vmTrade.curPB+"元<\/span><\/td><\/tr>"),i._("<\/table><\/div>"),i._('<div class="btn-group txt-c clear mt30">'),i._('<button class="btn btn-ok btn1" id="comit-submitBuy" type="button" dialog-btn-notify="#di#,1">确认<\/button>'),i._('<button class="btn btn-delete btn2" id="comit-buyCancel" type="button" dialog-btn-notify="#di#,2">取消<\/button>'),i._("<\/div>"),u.open(i.ts(),{width:550,notify:function(t){(n("#comit-submitBuy").blur(),n("#comit-buyCancel").blur(),t!=0)&&(t==1&&(vmTrade.isBusy=!0,n.ajax({url:"ashx/TradeHandler.ashx?action=submitBuy",type:"POST",data:{ticker:vmTrade.curStockPrice.ticker,pv:vmTrade.curPV,pb:vmTrade.curPB,sp:vmTrade.curPV/1e4*vmTrade.curSP,sl:vmTrade.curSLPrice,buyQuantity:vmTrade.maxShare,buyPrice:vmTrade.stockPrice,restingPrice:vmTrade.restingPrice,initPrice:vmTrade.initPrice,initQuantity:vmTrade.initQuantity,category:vmTrade.category},success:function(n){return vmTrade.isBusy=!1,n.code===1?vmTrade.category==1?(vmTrade.selectTab(2),h.alert("买入"+vmTrade.curStockPrice.shortNM+"委托成功",2,{title:"温馨提示",width:420})):vmTrade.category==2&&(vmTrade.selectTab(4),h.alert("触发买入"+vmTrade.curStockPrice.shortNM+"成功",2,{title:"温馨提示",width:420})):h.alert("买入"+vmTrade.curStockPrice.shortNM+"委托失败："+n.msg,1,{title:"温馨提示",width:420}),!1},error:function(n,t){console.log(t);vmTrade.isBusy=!1}})),h.close())}}),!1):(h.alert("非交易时间，不允许操作，请稍后再试",0,{title:"温馨提示",width:420}),!1)},submitSell:function(t){if(!vmTrade.isTradeTime)return h.alert("非交易时间，不允许操作，请稍后再试",0,{title:"温馨提示",width:420}),!1;var r=h,i=new s;return i._('<h4 class="font24 txt-c">卖出确认<\/h4>'),i._('<div class="delegation-sure mt20">'),i._('<table border="0" cellpadding="0" cellspacing="0">'),i._('<tr class="on"><td><label>账户：<\/label><span>'+vmTrade.accountNumber+"<\/span><\/td><\/tr>"),i._("<tr><td><label>名称：<\/label><span>"+t.stockName+"<\/span><\/td><\/tr>"),i._("<tr><td><label>代码：<\/label><span>"+t.ticker+"<\/span><\/td><\/tr>"),i._("<tr><td><label>倍数：<\/label><span>"+(t.principalValue/(t.performanceBond-t.additionalFee)).toFixed(0)+"倍<\/span><\/td><\/tr>"),i._('<tr class="on"><td><label>数量：<\/label><span>'+t.quantity+"股<\/span><\/td><\/tr>"),i._("<tr><td><label>买入时间：<\/label><span>"+new Date(t.confirmedTime).Format("yyyy-MM-dd HH:mm:ss")+"<\/span><\/td><\/tr>"),i._('<tr class="on"><td><label>持仓时间：<\/label><span>'+t.positionDays+"天<\/span><\/td><\/tr>"),i._("<tr><td><label>买入金额：<\/label><span>"+t.principalValue+"<\/span><\/td>"),i._('<td class="'+(t.floatingProfitLoss>0?"red":"blue")+' bold"><label>浮动盈亏：<\/label><span>'+t.floatingProfitLoss.toFixed(2)+"元<\/span><\/td><\/tr>"),i._("<tr><td><label>止损金额：<\/label><span>"+t.stopLoss+"元<\/span><\/td>"),i._('<td class="'+(t.floatingProfitLoss>0?"red":"blue")+' bold"><label>参考价格：<\/label><span>'+t.lastPrice.toFixed(2)+"元<\/span><\/td><\/tr>"),i._("<\/table><\/div>"),i._('<div class="btn-group txt-c clear mt30">'),i._('<button class="btn btn-ok btn1" id="comit-submitSell" type="button" dialog-btn-notify="#di#,1">确认<\/button>'),i._('<button class="btn btn-delete btn2" id="comit-sellCancel" type="button" dialog-btn-notify="#di#,2">取消<\/button>'),i._("<\/div>"),r.open(i.ts(),{width:550,notify:function(i){(n("#comit-submitSell").blur(),n("#comit-sellCancel").blur(),i!=0)&&(i==1&&n.ajax({url:"ashx/TradeHandler.ashx?action=submitSell",type:"POST",data:{contractId:t.contractId,category:1,restingPrice:0},success:function(n){return a.load(),y.load(),n.code===1?h.alert("卖出"+t.stockName+"委托成功",0,{title:"温馨提示",width:420}):h.alert("卖出"+t.stockName+"委托失败："+n.msg,0,{title:"温馨提示",width:420}),!1},error:function(n,t){console.log(t)}}),h.close())}}),!1},transferSell:function(t){return vmTrade.isTradeTime?(h.confirm("您确定要全部转让持仓股票："+t.stockName+" ("+t.ticker+") 吗?",0,{title:"温馨提示",width:480,notify:function(i){i===1&&n.ajax({url:"ashx/TradeHandler.ashx?action=transferSell",type:"POST",data:{contractId:t.contractId},success:function(n){return a.load(),y.load(),n.code===1?h.alert("持仓股票"+t.stockName+"转让成功",2,{title:"温馨提示",width:420}):h.alert("持仓股票"+t.stockName+"转让失败："+n.msg,1,{title:"温馨提示",width:420}),!1},error:function(n,t){console.log(t)}})}}),!1):(h.alert("非交易时间，不允许操作，请稍后再试",0,{title:"温馨提示",width:420}),!1)},subPrice2:function(t){vmTrade.restingPrice=n("#sellRestingPrice").val().trim();c.isNumber(vmTrade.restingPrice)||(vmTrade.restingPrice=n("#restingLastPrice").val());vmTrade.restingPrice=(parseFloat(vmTrade.restingPrice)-.01).toFixed(2);parseFloat(vmTrade.restingPrice)>=parseFloat((t*.9).toFixed(2))&&n("#sellRestingPrice").val(vmTrade.restingPrice)},addPrice2:function(t){vmTrade.restingPrice=n("#sellRestingPrice").val().trim();c.isNumber(vmTrade.restingPrice)||(vmTrade.restingPrice=n("#restingLastPrice").val());vmTrade.restingPrice=(parseFloat(vmTrade.restingPrice)+.01).toFixed(2);parseFloat(vmTrade.restingPrice)<=parseFloat((t*1.1).toFixed(2))&&n("#sellRestingPrice").val(vmTrade.restingPrice)},setPrice2:function(t){vmTrade.restingPrice=n("#sellRestingPrice").val().trim();c.isNumber(vmTrade.restingPrice)||(vmTrade.restingPrice=n("#restingLastPrice").val());n("#sellRestingPrice").val(vmTrade.restingPrice);parseFloat(vmTrade.restingPrice)>=parseFloat((t*1.1).toFixed(2))&&(vmTrade.restingPrice=(t*1.1).toFixed(2),n("#sellRestingPrice").val(vmTrade.restingPrice));parseFloat(vmTrade.restingPrice)<=parseFloat((t*.9).toFixed(2))&&(vmTrade.restingPrice=(t*.9).toFixed(2),n("#sellRestingPrice").val(vmTrade.restingPrice))},restingSell:function(t){if(it)vmTrade.restingSell2(t);else{var r=h,i=new s;i._('<h4 class="font24 red txt-c">风险提示<\/h4>');i._('<div class="risk-warning">当实盘成交价出现该触发价时，<b class="bold blue">投资人会以该触发时间发起市价卖出，最终成交的价格以实际成交价格为准<\/b>，而非以设置的触发价为准，如有疑问可申请交割单，该功能与券商委托挂单有很大的区别，请谨慎使用！如阅毕并确认无误，点击确认按钮，此次触发卖出生效。<\/div>');i._('<div class="checkbox checkbox2">');i._('<input type="checkbox" id="ckTip2" name="checkboox[]">');i._('<label for="ckTip2">以后不再提醒<\/label><\/div>');i._('<div class="txt-c mt20"><input id="comit-tip" class="btn btn-sure sure" type="button" dialog-btn-notify="#di#,1" value="确 认"><\/div>');r.open(i.ts(),{width:550,notify:function(i){if(n("#comit-tip").blur(),i!=0){var r=n("#ckTip2").is(":checked");r&&(o.setCookie("IsShowRiskTip2",!1),it=!0);h.close();vmTrade.restingSell2(t)}}})}},restingSell2:function(t){var r=h,i=new s;i._('<h4 class="font24 txt-c">触发卖出<\/h4>');i._('<div class="clear mt30">');i._('<div class="delegation-left fl txt-c">');i._('<input type="text" placeholder="'+t.stockName+'" class="agu blue-agu" disabled style="cursor:default"">');i._('<p><input id="restingLastPrice" type="text" placeholder="'+t.lastPrice.toFixed(2)+'" class="agu blue-agu" disabled style="cursor:default"><\/p>');i._('<p class="clear money-input sale-input"><i class="fl" onclick="vmTrade.subPrice2('+t.prevClosePrice+')"><img src="images/minus.png"><\/i><input id="sellRestingPrice" onchange="vmTrade.setPrice2('+t.prevClosePrice+')" type="text" value="'+t.lastPrice.toFixed(2)+'"><i class="fr" onclick="vmTrade.addPrice2('+t.prevClosePrice+')"><img src="images/plus.png"><\/i><\/p>');i._('<input id="comit-price" type="button" class="btn btn-delega blue-delega" dialog-btn-notify="#di#,1" value="确 认">');i._('<p class="clear mt20 pl-pr10"><span class="fl red">涨停'+(t.prevClosePrice*1.1).toFixed(2)+'<\/span><span class="fr blue">跌停'+(t.prevClosePrice*.9).toFixed(2)+"<\/span><\/p>");i._("<\/div>");i._('<div id="dialogDivPrice" class="delegation-right fr blue-delega-right">');i._("<\/div>");i._("<\/div>");r.open(i.ts(),{width:550,notify:function(i){if(n("#comit-price").blur(),i==0){clearInterval(d);return}vmTrade.restingPrice=n("#sellRestingPrice").val().trim();clearInterval(d);h.close();vmTrade.restingSell3(t)}});vmTrade.loadSellDialogPrice(t.ticker);d=setInterval("vmTrade.loadSellDialogPrice("+t.ticker+")",1e3)},restingSell3:function(t){var r=h,i=new s;i._('<h4 class="font24 txt-c">触发卖出确认<\/h4>');i._('<div class="delegation-sure mt20">');i._('<table border="0" cellpadding="0" cellspacing="0">');i._('<tr class="on"><td><label>账户：<\/label><span>'+vmTrade.accountNumber+"<\/span><\/td><\/tr>");i._("<tr><td><label>名称：<\/label><span>"+t.stockName+"<\/span><\/td><\/tr>");i._("<tr><td><label>代码：<\/label><span>"+t.ticker+"<\/span><\/td><\/tr>");i._("<tr><td><label>倍数：<\/label><span>"+(t.principalValue/(t.performanceBond-t.additionalFee)).toFixed(0)+"倍<\/span><\/td><\/tr>");i._('<tr class="on"><td><label>数量：<\/label><span>'+t.quantity+"股<\/span><\/td><\/tr>");i._("<tr><td><label>委托时间：<\/label><span>"+(new Date).Format("yyyy-MM-dd HH:mm:ss")+"<\/span><\/td><\/tr>");i._("<tr><td><label>买入时间：<\/label><span>"+new Date(t.confirmedTime).Format("yyyy-MM-dd HH:mm:ss")+"<\/span><\/td><\/tr>");i._('<tr class="on"><td><label>持仓时间：<\/label><span>'+t.positionDays+"天<\/span><\/td><\/tr>");i._("<tr><td><label>买入金额：<\/label><span>"+t.principalValue+"<\/span><\/td>");i._("<td><label>买入价格：<\/label><span>"+t.buyPrice.toFixed(2)+"<\/span><\/td><\/tr>");i._("<tr><td><label>止损金额：<\/label><span>"+t.stopLoss.toFixed(0)+"元<\/span><\/td>");i._("<td><label>保证金额：<\/label><span>"+t.performanceBond.toFixed(0)+"元<\/span><\/td><\/tr>");i._('<tr><td class="'+(vmTrade.restingPrice>t.buyPrice?"red":vmTrade.restingPrice<t.buyPrice?"blue":"black")+' bold"><label>委托价格：<\/label><span>'+vmTrade.restingPrice+"元<\/span><\/td>");i._('<td class="'+(vmTrade.restingPrice>t.buyPrice?"red":vmTrade.restingPrice<t.buyPrice?"blue":"black")+' bold"><label>参考盈亏：<\/label><span>'+((vmTrade.restingPrice-t.buyPrice)*t.quantity).toFixed(2)+"元<\/span><\/td><\/tr>");i._("<\/table><\/div>");i._('<div class="blue tips-pop blue-tips">风险提示：我们将接受您的请求，将在'+vmTrade.restingPrice+"元的价位发起此次股票的点卖策略，最终卖出价格以实际成交价格为准，股市行情变化快速，当您资金量较大时，请谨慎使用此功能，以避免不需要的损失！>>><\/div>");i._('<div class="btn-group txt-c clear">');i._('<button class="btn btn-ok btn3 btn-blue" id="comit-restingSubmitSell" type="button" dialog-btn-notify="#di#,1">确认<\/button>');i._('<button class="btn btn-delete btn4 btn-blue" id="comit-restingSellCancel" type="button" dialog-btn-notify="#di#,2">取消<\/button>');i._("<\/div>");r.open(i.ts(),{width:550,notify:function(i){if(n("#comit-restingSubmitSell").blur(),n("#comit-restingSellCancel").blur(),i!=0){if(i==1){var u=vmTrade.restingPrice;if(u.length==0){r.alert("请输入挂单价格",0,{notify:function(){n("#restingSellPrice").focus()}});return}if(!/^[+]?\d*\.?\d{0,2}$/.test(u)){r.alert("输入价格格式有误",0,{notify:function(){n("#restingSellPrice").focus()}});return}n.ajax({url:"ashx/TradeHandler.ashx?action=submitSell",type:"POST",data:{contractId:t.contractId,category:2,restingPrice:u},success:function(n){return a.load(),n.code===1?h.alert("触发卖出"+t.stockName+"的请求已受理",2,{title:"温馨提示",width:420}):h.alert("触发卖出"+t.stockName+"的请求失败："+n.msg,1,{title:"温馨提示",width:420}),!1},error:function(n,t){console.log(t)}})}h.close()}}})},loadSellDialogPrice:function(t){n.ajax({url:"ashx/TradeHandler.ashx?action=getPriceFromSql",type:"POST",data:{ticker:t},success:function(t){var r=new s;for(r._('<table border="0" cellpadding="0" cellspacing="0">'),r._('<colgroup><col style="width:40px;"><col style="width:55px;"><col style="width:75px;"><\/colgroup>'),i=0;i<t.data.askBook.length;i++)r._("<tr><td>卖"+FormatIntToCN(Math.abs(i-5))+'<\/td><td class="txt-r">'+t.data.askBook[i].price.toFixed(2)+'<\/td><td class="txt-r">'+numberFormat(t.data.askBook[i].volume)+"<\/td><\/tr>");for(r._("<\/table>"),r._('<table border="0" cellpadding="0" cellspacing="0" class="mt30">'),r._('<colgroup><col style="width:40px;"><col style="width:55px;"><col style="width:75px;"><\/colgroup>'),i=0;i<t.data.bidBook.length;i++)r._("<tr><td>买"+FormatIntToCN(i+1)+'<\/td><td class="txt-r">'+t.data.bidBook[i].price.toFixed(2)+'<\/td><td class="txt-r">'+numberFormat(t.data.bidBook[i].volume)+"<\/td><\/tr>");r._("<\/table>");n("#dialogDivPrice").html(r.ts());n("#restingLastPrice").val(t.data.lastPrice.toFixed(2))},error:function(n,t){console.log(t)}})},loadTradeSetting:function(){n.ajax({url:"ashx/TradeHandler.ashx?action=getTradeSetting",type:"POST",success:function(n){vmTrade.tradeTimeRange=n.tradeTimeRange;vmTrade.serviceFeeRate=n.serviceFeeRate;vmTrade.deferFeeRate=n.deferFeeRate;vmTrade.maxPriceChange=n.maxPriceChange;vmTrade.syncRate=n.syncRate;vmTrade.asyncRate=n.asyncRate;vmTrade.leverage=n.leverage;vmTrade.SL=n.SL;vmTrade.SP=n.SP;vmTrade.PV=n.PV;vmTrade.setSL(0)},error:function(n,t){console.log("业务规则加载失败",t)}})},addPerformanceBond:function(t){var r=h,i=new s;i._('<h4 class="font24 txt-c">追加保证金<\/h4>');i._('<div class="delegation-sure mt20">');i._('<table border="0" cellpadding="0" cellspacing="0">');i._('<tr class="on"><td><label>账户：<\/label><span>'+vmTrade.accountNumber+"<\/span><\/td><\/tr>");i._("<tr><td><label>名称：<\/label><span>"+t.stockName+"<\/span><\/td>");i._('<td><label>当前止损金额：<\/label><span id="spSL">'+t.stopLoss.toFixed(0)+"元<\/span><\/td><\/tr>");i._("<tr><td><label>代码：<\/label><span>"+t.ticker+"<\/span><\/td>");i._('<td><label>追加后止损金额：<\/label><span id="spDown">'+t.stopLoss.toFixed(0)+"元<\/span><\/td><\/tr>");i._("<\/table><\/div>");i._('<div class="add-money txt-c mt50">');i._("<label>追加金额（元）<\/label>");i._('<input id="amount" onkeyup="changeLossFee()" type="text" placeholder="追加金额为100的倍数">');i._("<\/div>");i._('<div class="btn-group txt-c clear">');i._('<button class="btn btn-ok btn3 btn-blue" id="comit-submitAddPerformanceBond" type="button" dialog-btn-notify="#di#,1">确认<\/button>');i._('<button class="btn btn-delete btn4 btn-blue" id="comit-submitCancelPerformanceBond" type="button" dialog-btn-notify="#di#,2">取消<\/button>');i._("<\/div>");r.open(i.ts(),{width:550,notify:function(i){if(n("#comit-submitAddPerformanceBond").blur(),n("#comit-submitCancelPerformanceBond").blur(),i!=0){if(i==1){var u=n("#amount"),f=u.val();if(f.length==0){r.alert("请输入追加金额",0,{notify:function(){u.focus()}});return}if(!/^\+?[1-9][0-9]*$/.test(f)){r.alert("输入金额格式有误",0,{notify:function(){u.focus()}});return}if(parseInt(f)<=0){r.alert("追加金额必须大于0",0,{notify:function(){u.focus()}});return}if(parseInt(f)%100!=0){r.alert("追加金额必须为100的倍数",0,{notify:function(){u.focus()}});return}n.ajax({url:"ashx/TradeHandler.ashx?action=additionalFee",type:"POST",data:{contractID:t.contractId,amount:parseInt(f)},success:function(n){return n.code===1?h.alert("追加保证金成功",2,{title:"温馨提示",width:420,notify:function(){a.load()}}):h.alert("追加保证金失败："+n.msg,1,{title:"温馨提示",width:420,notify:function(){a.load()}}),!1}})}h.close()}}})},showDeferCondition:function(){var t=h,n=new s;n._('<div style="padding:20px;color:#ca9247;">满足以下2个条件，自动递延：<br>1、不是高风险股票<br>2、在交易日14：55，策略满足公式：（浮动盈亏＋保证金）>买入金额*6％ ，并且余额够缴纳递延费。<\/div>');t.open(n.ts(),{title:"什么是递延条件？",width:354})},leverage:[10,8,4,2],curLeverage:10,SL:[-.8,-.84,-.92,-.96],setSL:function(n){vmTrade.curSL=vmTrade.SL[n];vmTrade.curLeverage=vmTrade.leverage[n]},curSL:-.8,ableCurSL:-.8,SP:[3e3,5e3],setSP:function(n){vmTrade.curSP=n},curSP:3e3,PV:[],curPV:1e4,setPV:function(n){vmTrade.curPV=n}});vmTrade.getServerTime();t.scan();vmTrade.loadTradeSetting();vmTrade.getPrice();a.load();v.load();y.load();vmTrade.selectTab(rt);setInterval(function(){if(vmTrade.getServerTime(),u.inititalized&&!vmTrade.isTradeTime)return!1;if(nt===vmTrade.curStockPrice.securityID&&b){var n=((new Date).getTime()-b.getTime())/1e3;if(n<2)return!1}return vmTrade.getPrice(),!1},1e3);setInterval(function(){vmTrade.activeTab===2&&a.load("k");vmTrade.activeTab===4&&v.load()},3e3);n(".ui-icon-help").each(function(){n(this).tips({dire:6})})});Date.prototype.Format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length==1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};
//# sourceMappingURL=trade.min.js.map
